{"version":3,"sources":["app.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","ComponentManager","permissions","onReady","sentMessages","messageQueue","loggingEnabled","acceptsThemes","activeThemes","initialPermissions","onReadyCallback","coallesedSaving","coallesedSavingDelay","registerMessageHandler","value","_this","messageHandler","event","console","log","data","document","referrer","URL","origin","eventOrigin","parsedData","JSON","parse","handleMessage","addEventListener","window","payload","action","sessionKey","componentData","activateThemes","themes","original","originalMessage","filter","message","messageId","alert","callback","environment","platform","uuid","isMobile","requestPermissions","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_iterator","Symbol","iterator","_step","next","done","postMessage","err","activeThemeUrls","getSelfComponentUUID","isRunningInDesktopApplication","setComponentDataValueForKey","clearComponentData","componentDataValueForKey","push","generateUUID","api","sentMessage","stringify","parent","setSize","type","width","height","bind","streamItems","contentTypes","Array","isArray","content_types","items","streamContextItem","_this2","item","isNewItem","lastStreamedItem","pendingSaveTimeout","clearTimeout","_performSavingOfItems","pendingSaveParams","selectItem","jsonObjectForItem","createItem","associateItem","createItems","_this3","mapped","map","deassociateItem","clearSelection","content_type","deleteItem","deleteItems","params","sendCustomEvent","saveItem","skipDebouncer","arguments","saveItems","saveItemWithPresave","presave","saveItemsWithPresave","_ref","mappedItems","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_this4","pendingSaveItems","incomingIds","preexistingItems","includes","concat","setTimeout","copy","assign","children","getItemAppDataValue","AppDomain","content","appData","incomingUrls","sort","toString","themesToActivate","themesToDeactivate","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","activeUrl","candidate","_i","_themesToDeactivate","theme","deactivateTheme","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_iterator4","_step4","url","link","createElement","id","btoa","href","rel","media","className","getElementsByTagName","appendChild","themeElementForUrl","elements","from","getElementsByClassName","slice","find","element","disabled","parentNode","removeChild","crypto","msCrypto","buf","Uint32Array","getRandomValues","idx","replace","c","r","v","d","Date","getTime","performance","now","Math","random","floor","module","exports","SNTheme","SNSmartTag","SNServerExtension","SNMfa","SNEncryptedStorage","SNTag","SNNote","SNExtension","Action","SNEditor","SNComponent","defineProperties","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","call","_standardFileJs","require","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_SFItem","json_obj","disassociatedItemIds","associatedItemIds","mapContentToLocalProperties","hosted_url","legacy_url","local_url","offlineOnly","valid_until","name","autoupdateDisabled","package_info","area","active","handleDeletedContent","structureParams","superParams","isEditor","isTheme","isDefaultEditor","getAppDataItem","setLastSize","size","setAppDataItem","getLastSize","getClientDataKey","hasValidHostedUrl","keysToIgnoreWhenCheckingContentEquality","isAssociative","Component","associativeAreas","associateWithItem","isExplicitlyEnabledForItem","indexOf","isExplicitlyDisabledForItem","SFItem","_SFItem2","notes","default","systemEditor","referenceParams","references","_","note","addItemAsRelationship","removeItemAsRelationship","pull","removeAndDirtyAllRelationships","removeReferencesNotPresentIn","uuids","ref","forEach","remove","potentialItemOfInterestHasChangedItsUUID","newItem","oldUUID","newUUID","setData","dataHasChanged","dataForKey","json","merge","running","error","lastExecuted","_SFItem3","actions","actionsWithContextForItem","context","description","supported_types","a","omit","_SFItem4","text","tags","title","setIsBeingReferencedBy","clearSavedTagsString","setIsNoLongerBeingReferencedBy","isBeingRemovedLocally","tag","informReferencesOfUUIDChange","return","tagDidFinishSyncing","safeText","safeTitle","savedTagsString","tagsString","arrayToDisplayString","filterDummyNotes","filtered","dummy","_SFItem5","_this5","updateLocalRelationships","_this6","didFinishSyncing","isSmartTag","b","join","_SFItem6","apply","storage","_SFItem7","doNotEncrypt","_SFItem8","_SNTag","json_ob","_this10","systemSmartTags","SystemSmartTagIdAllNotes","isSystemTag","isAllTag","predicate","SFPredicate","fromArray","SystemSmartTagIdArchivedNotes","isArchiveTag","SystemSmartTagIdTrashedNotes","isTrashTag","_SNComponent","_this11","isLayerable","layerable","setMobileRules","rules","getMobileRules","constants","hasMobileRules","setNotAvailOnMobile","na","getNotAvailOnMobile","setMobileActive","isMobileActive","e","angular","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentManager","delimiter","resolveRawTags","masterTag","sortTags","aTitle","toLowerCase","bTitle","resolved","rawTags","findResolvedTag","pendingDummy","unshift","comps","split","displayTitle","getParent","depth","parentTitle","tagTitle","index","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","createTag","startsWith","components","substring","smartTag","keypath","operator","createdTag","selectOnLoad","selectTag","multiSelect","clearMultipleTagsSelection","multipleTags","smartMaster","createEphemeralSmartTagForMultiTags","editing","tagNames","toggleCollapse","clientData","collapsed","saveTags","selected","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","$element","focus","tagId","drop","isDraggable","isDroppable","attrs","el","draggable","counter","dataTransfer","effectAllowed","classList","add","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"AAAA;;;;;;;;AAEA,SAASA,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,oBAAoBC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,QAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4BC,OAAOC,cAAP,CAAsBT,MAAtB,EAA8BI,WAAWM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE;;AAE7T,SAASO,YAAT,CAAsBd,WAAtB,EAAmCe,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBb,kBAAkBF,YAAYiB,SAA9B,EAAyCF,UAAzC,EAAsD,IAAIC,WAAJ,EAAiBd,kBAAkBF,WAAlB,EAA+BgB,WAA/B,EAA6C,OAAOhB,WAAP;AAAqB;;AAEvN,IAAIkB;AACJ;AACA,YAAY;AACV,WAASA,gBAAT,CAA0BC,WAA1B,EAAuCC,OAAvC,EAAgD;AAC9CtB,oBAAgB,IAAhB,EAAsBoB,gBAAtB;;AAEA,SAAKG,YAAL,GAAoB,EAApB;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,cAAL,GAAsB,KAAtB;AACA,SAAKC,aAAL,GAAqB,IAArB;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,kBAAL,GAA0BP,WAA1B;AACA,SAAKQ,eAAL,GAAuBP,OAAvB;AACA,SAAKQ,eAAL,GAAuB,IAAvB;AACA,SAAKC,oBAAL,GAA4B,GAA5B;AACA,SAAKC,sBAAL;AACD;;AAEDhB,eAAaI,gBAAb,EAA+B,CAAC;AAC9BL,SAAK,wBADyB;AAE9BkB,WAAO,SAASD,sBAAT,GAAkC;AACvC,UAAIE,QAAQ,IAAZ;;AAEA,UAAIC,iBAAiB,SAASA,cAAT,CAAwBC,KAAxB,EAA+B;AAClD,YAAIF,MAAMT,cAAV,EAA0B;AACxBY,kBAAQC,GAAR,CAAY,kCAAZ,EAAgDF,MAAMG,IAAtD;AACD,SAHiD,CAGhD;AACF;AACA;;;AAGA,YAAIC,SAASC,QAAb,EAAuB;AACrB,cAAIA,WAAW,IAAIC,GAAJ,CAAQF,SAASC,QAAjB,EAA2BE,MAA1C;AACA,cAAIC,cAAc,IAAIF,GAAJ,CAAQN,MAAMO,MAAd,EAAsBA,MAAxC;;AAEA,cAAIF,aAAaG,WAAjB,EAA8B;AAC5B;AACD;AACF,SAfiD,CAehD;AACF;;;AAGA,YAAI,CAACV,MAAMS,MAAX,EAAmB;AACjBT,gBAAMS,MAAN,GAAeP,MAAMO,MAArB;AACD,SAFD,MAEO,IAAIP,MAAMO,MAAN,KAAiBT,MAAMS,MAA3B,EAAmC;AACxC;AACA;AACD,SAxBiD,CAwBhD;;;AAGF,YAAIJ,OAAOH,MAAMG,IAAjB;AACA,YAAIM,aAAa,OAAON,IAAP,KAAgB,QAAhB,GAA2BO,KAAKC,KAAL,CAAWR,IAAX,CAA3B,GAA8CA,IAA/D;;AAEAL,cAAMc,aAAN,CAAoBH,UAApB;AACD,OA/BD;AAgCA;;;;;;;;;;;AAYAL,eAASS,gBAAT,CAA0B,SAA1B,EAAqC,UAAUb,KAAV,EAAiB;AACpDD,uBAAeC,KAAf;AACD,OAFD,EAEG,KAFH;AAGAc,aAAOD,gBAAP,CAAwB,SAAxB,EAAmC,UAAUb,KAAV,EAAiB;AAClDD,uBAAeC,KAAf;AACD,OAFD,EAEG,KAFH;AAGD;AAvD6B,GAAD,EAwD5B;AACDrB,SAAK,eADJ;AAEDkB,WAAO,SAASe,aAAT,CAAuBG,OAAvB,EAAgC;AACrC,UAAIA,QAAQC,MAAR,KAAmB,sBAAvB,EAA+C;AAC7C,aAAKC,UAAL,GAAkBF,QAAQE,UAA1B;AACA,aAAKC,aAAL,GAAqBH,QAAQG,aAA7B;AACA,aAAKhC,OAAL,CAAa6B,QAAQZ,IAArB;;AAEA,YAAI,KAAKd,cAAT,EAAyB;AACvBY,kBAAQC,GAAR,CAAY,iDAAZ,EAA+Da,OAA/D;AACD;AACF,OARD,MAQO,IAAIA,QAAQC,MAAR,KAAmB,QAAvB,EAAiC;AACtC,YAAI,KAAK1B,aAAT,EAAwB;AACtB,eAAK6B,cAAL,CAAoBJ,QAAQZ,IAAR,CAAaiB,MAAjC;AACD;AACF,OAJM,MAIA,IAAIL,QAAQM,QAAZ,EAAsB;AAC3B;AACA,YAAIC,kBAAkB,KAAKnC,YAAL,CAAkBoC,MAAlB,CAAyB,UAAUC,OAAV,EAAmB;AAChE,iBAAOA,QAAQC,SAAR,KAAsBV,QAAQM,QAAR,CAAiBI,SAA9C;AACD,SAFqB,EAEnB,CAFmB,CAAtB;;AAIA,YAAI,CAACH,eAAL,EAAsB;AACpB;AACAI,gBAAM,4JAAN;AACD;;AAED,YAAIJ,gBAAgBK,QAApB,EAA8B;AAC5BL,0BAAgBK,QAAhB,CAAyBZ,QAAQZ,IAAjC;AACD;AACF;AACF;AA9BA,GAxD4B,EAuF5B;AACDxB,SAAK,SADJ;AAEDkB,WAAO,SAASX,OAAT,CAAiBiB,IAAjB,EAAuB;AAC5B,WAAKyB,WAAL,GAAmBzB,KAAKyB,WAAxB;AACA,WAAKC,QAAL,GAAgB1B,KAAK0B,QAArB;AACA,WAAKC,IAAL,GAAY3B,KAAK2B,IAAjB;AACA,WAAKC,QAAL,GAAgB,KAAKH,WAAL,IAAoB,QAApC;;AAEA,UAAI,KAAKpC,kBAAL,IAA2B,KAAKA,kBAAL,CAAwBpB,MAAxB,GAAiC,CAAhE,EAAmE;AACjE,aAAK4D,kBAAL,CAAwB,KAAKxC,kBAA7B;AACD;;AAED,UAAIyC,4BAA4B,IAAhC;AACA,UAAIC,oBAAoB,KAAxB;AACA,UAAIC,iBAAiBC,SAArB;;AAEA,UAAI;AACF,aAAK,IAAIC,YAAY,KAAKjD,YAAL,CAAkBkD,OAAOC,QAAzB,GAAhB,EAAsDC,KAA3D,EAAkE,EAAEP,4BAA4B,CAACO,QAAQH,UAAUI,IAAV,EAAT,EAA2BC,IAAzD,CAAlE,EAAkIT,4BAA4B,IAA9J,EAAoK;AAClK,cAAIT,UAAUgB,MAAM3C,KAApB;AACA,eAAK8C,WAAL,CAAiBnB,QAAQR,MAAzB,EAAiCQ,QAAQrB,IAAzC,EAA+CqB,QAAQG,QAAvD;AACD;AACF,OALD,CAKE,OAAOiB,GAAP,EAAY;AACZV,4BAAoB,IAApB;AACAC,yBAAiBS,GAAjB;AACD,OARD,SAQU;AACR,YAAI;AACF,cAAI,CAACX,yBAAD,IAA8BI,UAAU,QAAV,KAAuB,IAAzD,EAA+D;AAC7DA,sBAAU,QAAV;AACD;AACF,SAJD,SAIU;AACR,cAAIH,iBAAJ,EAAuB;AACrB,kBAAMC,cAAN;AACD;AACF;AACF;;AAED,WAAK/C,YAAL,GAAoB,EAApB;;AAEA,UAAI,KAAKC,cAAT,EAAyB;AACvBY,gBAAQC,GAAR,CAAY,aAAZ,EAA2BC,IAA3B;AACD;;AAED,WAAKgB,cAAL,CAAoBhB,KAAK0C,eAAL,IAAwB,EAA5C;;AAEA,UAAI,KAAKpD,eAAT,EAA0B;AACxB,aAAKA,eAAL;AACD;AACF;AA/CA,GAvF4B,EAuI5B;AACDd,SAAK,sBADJ;AAEDkB,WAAO,SAASiD,oBAAT,GAAgC;AACrC,aAAO,KAAKhB,IAAZ;AACD;AAJA,GAvI4B,EA4I5B;AACDnD,SAAK,+BADJ;AAEDkB,WAAO,SAASkD,6BAAT,GAAyC;AAC9C,aAAO,KAAKnB,WAAL,KAAqB,SAA5B;AACD;AAJA,GA5I4B,EAiJ5B;AACDjD,SAAK,6BADJ;AAEDkB,WAAO,SAASmD,2BAAT,CAAqCrE,GAArC,EAA0CkB,KAA1C,EAAiD;AACtD,WAAKqB,aAAL,CAAmBvC,GAAnB,IAA0BkB,KAA1B;AACA,WAAK8C,WAAL,CAAiB,oBAAjB,EAAuC;AACrCzB,uBAAe,KAAKA;AADiB,OAAvC,EAEG,UAAUf,IAAV,EAAgB,CAAE,CAFrB;AAGD;AAPA,GAjJ4B,EAyJ5B;AACDxB,SAAK,oBADJ;AAEDkB,WAAO,SAASoD,kBAAT,GAA8B;AACnC,WAAK/B,aAAL,GAAqB,EAArB;AACA,WAAKyB,WAAL,CAAiB,oBAAjB,EAAuC;AACrCzB,uBAAe,KAAKA;AADiB,OAAvC,EAEG,UAAUf,IAAV,EAAgB,CAAE,CAFrB;AAGD;AAPA,GAzJ4B,EAiK5B;AACDxB,SAAK,0BADJ;AAEDkB,WAAO,SAASqD,wBAAT,CAAkCvE,GAAlC,EAAuC;AAC5C,aAAO,KAAKuC,aAAL,CAAmBvC,GAAnB,CAAP;AACD;AAJA,GAjK4B,EAsK5B;AACDA,SAAK,aADJ;AAEDkB,WAAO,SAAS8C,WAAT,CAAqB3B,MAArB,EAA6Bb,IAA7B,EAAmCwB,QAAnC,EAA6C;AAClD,UAAI,CAAC,KAAKV,UAAV,EAAsB;AACpB,aAAK7B,YAAL,CAAkB+D,IAAlB,CAAuB;AACrBnC,kBAAQA,MADa;AAErBb,gBAAMA,IAFe;AAGrBwB,oBAAUA;AAHW,SAAvB;AAKA;AACD;;AAED,UAAIH,UAAU;AACZR,gBAAQA,MADI;AAEZb,cAAMA,IAFM;AAGZsB,mBAAW,KAAK2B,YAAL,EAHC;AAIZnC,oBAAY,KAAKA,UAJL;AAKZoC,aAAK;AALO,OAAd;AAOA,UAAIC,cAAc5C,KAAKC,KAAL,CAAWD,KAAK6C,SAAL,CAAe/B,OAAf,CAAX,CAAlB;AACA8B,kBAAY3B,QAAZ,GAAuBA,QAAvB;AACA,WAAKxC,YAAL,CAAkBgE,IAAlB,CAAuBG,WAAvB,EAnBkD,CAmBb;;AAErC,UAAI,KAAKvB,QAAT,EAAmB;AACjBP,kBAAUd,KAAK6C,SAAL,CAAe/B,OAAf,CAAV;AACD;;AAED,UAAI,KAAKnC,cAAT,EAAyB;AACvBY,gBAAQC,GAAR,CAAY,kBAAZ,EAAgCsB,OAAhC;AACD;;AAEDV,aAAO0C,MAAP,CAAcb,WAAd,CAA0BnB,OAA1B,EAAmC,KAAKjB,MAAxC;AACD;AAhCA,GAtK4B,EAuM5B;AACD5B,SAAK,SADJ;AAEDkB,WAAO,SAAS4D,OAAT,CAAiBC,IAAjB,EAAuBC,KAAvB,EAA8BC,MAA9B,EAAsC;AAC3C,WAAKjB,WAAL,CAAiB,UAAjB,EAA6B;AAC3Be,cAAMA,IADqB;AAE3BC,eAAOA,KAFoB;AAG3BC,gBAAQA;AAHmB,OAA7B,EAIG,UAAUzD,IAAV,EAAgB,CAAE,CAJrB;AAKD;AARA,GAvM4B,EAgN5B;AACDxB,SAAK,oBADJ;AAEDkB,WAAO,SAASmC,kBAAT,CAA4B/C,WAA5B,EAAyC0C,QAAzC,EAAmD;AACxD,WAAKgB,WAAL,CAAiB,qBAAjB,EAAwC;AACtC1D,qBAAaA;AADyB,OAAxC,EAEG,UAAUkB,IAAV,EAAgB;AACjBwB,oBAAYA,UAAZ;AACD,OAFE,CAEDkC,IAFC,CAEI,IAFJ,CAFH;AAKD;AARA,GAhN4B,EAyN5B;AACDlF,SAAK,aADJ;AAEDkB,WAAO,SAASiE,WAAT,CAAqBC,YAArB,EAAmCpC,QAAnC,EAA6C;AAClD,UAAI,CAACqC,MAAMC,OAAN,CAAcF,YAAd,CAAL,EAAkC;AAChCA,uBAAe,CAACA,YAAD,CAAf;AACD;;AAED,WAAKpB,WAAL,CAAiB,cAAjB,EAAiC;AAC/BuB,uBAAeH;AADgB,OAAjC,EAEG,UAAU5D,IAAV,EAAgB;AACjBwB,iBAASxB,KAAKgE,KAAd;AACD,OAFE,CAEDN,IAFC,CAEI,IAFJ,CAFH;AAKD;AAZA,GAzN4B,EAsO5B;AACDlF,SAAK,mBADJ;AAEDkB,WAAO,SAASuE,iBAAT,CAA2BzC,QAA3B,EAAqC;AAC1C,UAAI0C,SAAS,IAAb;;AAEA,WAAK1B,WAAL,CAAiB,qBAAjB,EAAwC,IAAxC,EAA8C,UAAUxC,IAAV,EAAgB;AAC5D,YAAImE,OAAOnE,KAAKmE,IAAhB;AACA;;;;;;;AAOA,YAAIC,YAAY,CAACF,OAAOG,gBAAR,IAA4BH,OAAOG,gBAAP,CAAwB1C,IAAxB,KAAiCwC,KAAKxC,IAAlF;;AAEA,YAAIyC,aAAaF,OAAOI,kBAAxB,EAA4C;AAC1CC,uBAAaL,OAAOI,kBAApB;;AAEAJ,iBAAOM,qBAAP,CAA6BN,OAAOO,iBAApC;;AAEAP,iBAAOI,kBAAP,GAA4B,IAA5B;AACAJ,iBAAOO,iBAAP,GAA2B,IAA3B;AACD;;AAEDP,eAAOG,gBAAP,GAA0BF,IAA1B;AACA3C,iBAAS0C,OAAOG,gBAAhB;AACD,OAtBD;AAuBD;AA5BA,GAtO4B,EAmQ5B;AACD7F,SAAK,YADJ;AAEDkB,WAAO,SAASgF,UAAT,CAAoBP,IAApB,EAA0B;AAC/B,WAAK3B,WAAL,CAAiB,aAAjB,EAAgC;AAC9B2B,cAAM,KAAKQ,iBAAL,CAAuBR,IAAvB;AADwB,OAAhC;AAGD;AANA,GAnQ4B,EA0Q5B;AACD3F,SAAK,YADJ;AAEDkB,WAAO,SAASkF,UAAT,CAAoBT,IAApB,EAA0B3C,QAA1B,EAAoC;AACzC,WAAKgB,WAAL,CAAiB,aAAjB,EAAgC;AAC9B2B,cAAM,KAAKQ,iBAAL,CAAuBR,IAAvB;AADwB,OAAhC,EAEG,UAAUnE,IAAV,EAAgB;AACjB,YAAImE,OAAOnE,KAAKmE,IAAhB,CADiB,CACK;AACtB;;AAEA,YAAI,CAACA,IAAD,IAASnE,KAAKgE,KAAd,IAAuBhE,KAAKgE,KAAL,CAAW/F,MAAX,GAAoB,CAA/C,EAAkD;AAChDkG,iBAAOnE,KAAKgE,KAAL,CAAW,CAAX,CAAP;AACD;;AAED,aAAKa,aAAL,CAAmBV,IAAnB;AACA3C,oBAAYA,SAAS2C,IAAT,CAAZ;AACD,OAVE,CAUDT,IAVC,CAUI,IAVJ,CAFH;AAaD;AAhBA,GA1Q4B,EA2R5B;AACDlF,SAAK,aADJ;AAEDkB,WAAO,SAASoF,WAAT,CAAqBd,KAArB,EAA4BxC,QAA5B,EAAsC;AAC3C,UAAIuD,SAAS,IAAb;;AAEA,UAAIC,SAAShB,MAAMiB,GAAN,CAAU,UAAUd,IAAV,EAAgB;AACrC,eAAOY,OAAOJ,iBAAP,CAAyBR,IAAzB,CAAP;AACD,OAFY,CAAb;AAGA,WAAK3B,WAAL,CAAiB,cAAjB,EAAiC;AAC/BwB,eAAOgB;AADwB,OAAjC,EAEG,UAAUhF,IAAV,EAAgB;AACjBwB,oBAAYA,SAASxB,KAAKgE,KAAd,CAAZ;AACD,OAFE,CAEDN,IAFC,CAEI,IAFJ,CAFH;AAKD;AAbA,GA3R4B,EAyS5B;AACDlF,SAAK,eADJ;AAEDkB,WAAO,SAASmF,aAAT,CAAuBV,IAAvB,EAA6B;AAClC,WAAK3B,WAAL,CAAiB,gBAAjB,EAAmC;AACjC2B,cAAM,KAAKQ,iBAAL,CAAuBR,IAAvB;AAD2B,OAAnC;AAGD;AANA,GAzS4B,EAgT5B;AACD3F,SAAK,iBADJ;AAEDkB,WAAO,SAASwF,eAAT,CAAyBf,IAAzB,EAA+B;AACpC,WAAK3B,WAAL,CAAiB,kBAAjB,EAAqC;AACnC2B,cAAM,KAAKQ,iBAAL,CAAuBR,IAAvB;AAD6B,OAArC;AAGD;AANA,GAhT4B,EAuT5B;AACD3F,SAAK,gBADJ;AAEDkB,WAAO,SAASyF,cAAT,GAA0B;AAC/B,WAAK3C,WAAL,CAAiB,iBAAjB,EAAoC;AAClC4C,sBAAc;AADoB,OAApC;AAGD;AANA,GAvT4B,EA8T5B;AACD5G,SAAK,YADJ;AAEDkB,WAAO,SAAS2F,UAAT,CAAoBlB,IAApB,EAA0B3C,QAA1B,EAAoC;AACzC,WAAK8D,WAAL,CAAiB,CAACnB,IAAD,CAAjB,EAAyB3C,QAAzB;AACD;AAJA,GA9T4B,EAmU5B;AACDhD,SAAK,aADJ;AAEDkB,WAAO,SAAS4F,WAAT,CAAqBtB,KAArB,EAA4BxC,QAA5B,EAAsC;AAC3C,UAAI+D,SAAS;AACXvB,eAAOA,MAAMiB,GAAN,CAAU,UAAUd,IAAV,EAAgB;AAC/B,iBAAO,KAAKQ,iBAAL,CAAuBR,IAAvB,CAAP;AACD,SAFgB,CAEfT,IAFe,CAEV,IAFU,CAAV;AADI,OAAb;AAKA,WAAKlB,WAAL,CAAiB,cAAjB,EAAiC+C,MAAjC,EAAyC,UAAUvF,IAAV,EAAgB;AACvDwB,oBAAYA,SAASxB,IAAT,CAAZ;AACD,OAFD;AAGD;AAXA,GAnU4B,EA+U5B;AACDxB,SAAK,iBADJ;AAEDkB,WAAO,SAAS8F,eAAT,CAAyB3E,MAAzB,EAAiCb,IAAjC,EAAuCwB,QAAvC,EAAiD;AACtD,WAAKgB,WAAL,CAAiB3B,MAAjB,EAAyBb,IAAzB,EAA+B,UAAUA,IAAV,EAAgB;AAC7CwB,oBAAYA,SAASxB,IAAT,CAAZ;AACD,OAF8B,CAE7B0D,IAF6B,CAExB,IAFwB,CAA/B;AAGD;AANA,GA/U4B,EAsV5B;AACDlF,SAAK,UADJ;AAEDkB,WAAO,SAAS+F,QAAT,CAAkBtB,IAAlB,EAAwB3C,QAAxB,EAAkC;AACvC,UAAIkE,gBAAgBC,UAAU1H,MAAV,GAAmB,CAAnB,IAAwB0H,UAAU,CAAV,MAAiB1D,SAAzC,GAAqD0D,UAAU,CAAV,CAArD,GAAoE,KAAxF;AACA,WAAKC,SAAL,CAAe,CAACzB,IAAD,CAAf,EAAuB3C,QAAvB,EAAiCkE,aAAjC;AACD;AACD;;;;;AANC,GAtV4B,EAiW5B;AACDlH,SAAK,qBADJ;AAEDkB,WAAO,SAASmG,mBAAT,CAA6B1B,IAA7B,EAAmC2B,OAAnC,EAA4CtE,QAA5C,EAAsD;AAC3D,WAAKuE,oBAAL,CAA0B,CAAC5B,IAAD,CAA1B,EAAkC2B,OAAlC,EAA2CtE,QAA3C;AACD;AAJA,GAjW4B,EAsW5B;AACDhD,SAAK,sBADJ;AAEDkB,WAAO,SAASqG,oBAAT,CAA8B/B,KAA9B,EAAqC8B,OAArC,EAA8CtE,QAA9C,EAAwD;AAC7D,WAAKoE,SAAL,CAAe5B,KAAf,EAAsBxC,QAAtB,EAAgC,KAAhC,EAAuCsE,OAAvC;AACD;AAJA,GAtW4B,EA2W5B;AACDtH,SAAK,uBADJ;AAEDkB,WAAO,SAAS8E,qBAAT,CAA+BwB,IAA/B,EAAqC;AAC1C,UAAIhC,QAAQgC,KAAKhC,KAAjB;AAAA,UACI8B,UAAUE,KAAKF,OADnB;AAAA,UAEItE,WAAWwE,KAAKxE,QAFpB;AAGA;AACAsE,iBAAWA,SAAX;AACA,UAAIG,cAAc,EAAlB;AACA,UAAIC,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkBnE,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAIoE,aAAarC,MAAM7B,OAAOC,QAAb,GAAjB,EAA2CkE,MAAhD,EAAwD,EAAEJ,6BAA6B,CAACI,SAASD,WAAW/D,IAAX,EAAV,EAA6BC,IAA5D,CAAxD,EAA2H2D,6BAA6B,IAAxJ,EAA8J;AAC5J,cAAI/B,OAAOmC,OAAO5G,KAAlB;AACAuG,sBAAYjD,IAAZ,CAAiB,KAAK2B,iBAAL,CAAuBR,IAAvB,CAAjB;AACD;AACF,OALD,CAKE,OAAO1B,GAAP,EAAY;AACZ0D,6BAAqB,IAArB;AACAC,0BAAkB3D,GAAlB;AACD,OARD,SAQU;AACR,YAAI;AACF,cAAI,CAACyD,0BAAD,IAA+BG,WAAW,QAAX,KAAwB,IAA3D,EAAiE;AAC/DA,uBAAW,QAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIF,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;;AAED,WAAK5D,WAAL,CAAiB,YAAjB,EAA+B;AAC7BwB,eAAOiC;AADsB,OAA/B,EAEG,UAAUjG,IAAV,EAAgB;AACjBwB,oBAAYA,UAAZ;AACD,OAJD;AAKD;AACD;;;;;AAvCC,GA3W4B,EAuZ5B;AACDhD,SAAK,WADJ;AAEDkB,WAAO,SAASkG,SAAT,CAAmB5B,KAAnB,EAA0BxC,QAA1B,EAAoC;AACzC,UAAI+E,SAAS,IAAb;;AAEA,UAAIb,gBAAgBC,UAAU1H,MAAV,GAAmB,CAAnB,IAAwB0H,UAAU,CAAV,MAAiB1D,SAAzC,GAAqD0D,UAAU,CAAV,CAArD,GAAoE,KAAxF;AACA,UAAIG,UAAUH,UAAU1H,MAAV,GAAmB,CAAnB,GAAuB0H,UAAU,CAAV,CAAvB,GAAsC1D,SAApD;;AAEA;AACA;AACA,UAAI,CAAC,KAAKuE,gBAAV,EAA4B;AAC1B,aAAKA,gBAAL,GAAwB,EAAxB;AACD;;AAED,UAAI,KAAKjH,eAAL,IAAwB,IAAxB,IAAgC,CAACmG,aAArC,EAAoD;AAClD,YAAI,KAAKpB,kBAAT,EAA6B;AAC3BC,uBAAa,KAAKD,kBAAlB;AACD;;AAED,YAAImC,cAAczC,MAAMiB,GAAN,CAAU,UAAUd,IAAV,EAAgB;AAC1C,iBAAOA,KAAKxC,IAAZ;AACD,SAFiB,CAAlB,CALkD,CAO9C;AACJ;;AAEA,YAAI+E,mBAAmB,KAAKF,gBAAL,CAAsBpF,MAAtB,CAA6B,UAAU+C,IAAV,EAAgB;AAClE,iBAAO,CAACsC,YAAYE,QAAZ,CAAqBxC,KAAKxC,IAA1B,CAAR;AACD,SAFsB,CAAvB,CAVkD,CAY9C;;AAEJ,aAAK6E,gBAAL,GAAwBE,iBAAiBE,MAAjB,CAAwB5C,KAAxB,CAAxB,CAdkD,CAcM;;AAExD,aAAKS,iBAAL,GAAyB;AACvBT,iBAAO,KAAKwC,gBADW;AAEvBV,mBAASA,OAFc;AAGvBtE,oBAAUA;AAHa,SAAzB;AAKA,aAAK8C,kBAAL,GAA0BuC,WAAW,YAAY;AAC/CN,iBAAO/B,qBAAP,CAA6B+B,OAAO9B,iBAApC;;AAEA8B,iBAAOC,gBAAP,GAA0B,EAA1B;AACAD,iBAAOjC,kBAAP,GAA4B,IAA5B;AACAiC,iBAAO9B,iBAAP,GAA2B,IAA3B;AACD,SANyB,EAMvB,KAAKjF,oBANkB,CAA1B;AAOD,OA5BD,MA4BO;AACL,aAAKgF,qBAAL,CAA2B;AACzBR,iBAAOA,KADkB;AAEzB8B,mBAASA,OAFgB;AAGzBtE,oBAAUA;AAHe,SAA3B;AAKD;AACF;AAjDA,GAvZ4B,EAyc5B;AACDhD,SAAK,mBADJ;AAEDkB,WAAO,SAASiF,iBAAT,CAA2BR,IAA3B,EAAiC;AACtC,UAAI2C,OAAOxI,OAAOyI,MAAP,CAAc,EAAd,EAAkB5C,IAAlB,CAAX;AACA2C,WAAKE,QAAL,GAAgB,IAAhB;AACAF,WAAKzD,MAAL,GAAc,IAAd;AACA,aAAOyD,IAAP;AACD;AAPA,GAzc4B,EAid5B;AACDtI,SAAK,qBADJ;AAEDkB,WAAO,SAASuH,mBAAT,CAA6B9C,IAA7B,EAAmC3F,GAAnC,EAAwC;AAC7C,UAAI0I,YAAY,sBAAhB;AACA,UAAIlH,OAAOmE,KAAKgD,OAAL,CAAaC,OAAb,IAAwBjD,KAAKgD,OAAL,CAAaC,OAAb,CAAqBF,SAArB,CAAnC;;AAEA,UAAIlH,IAAJ,EAAU;AACR,eAAOA,KAAKxB,GAAL,CAAP;AACD,OAFD,MAEO;AACL,eAAO,IAAP;AACD;AACF;AACD;;AAZC,GAjd4B,EA+d5B;AACDA,SAAK,gBADJ;AAEDkB,WAAO,SAASsB,cAAT,CAAwBqG,YAAxB,EAAsC;AAC3C,UAAI,KAAKnI,cAAT,EAAyB;AACvBY,gBAAQC,GAAR,CAAY,iBAAZ,EAA+BsH,YAA/B;AACD;;AAED,UAAI,KAAKjI,YAAL,CAAkBkI,IAAlB,GAAyBC,QAAzB,MAAuCF,aAAaC,IAAb,GAAoBC,QAApB,EAA3C,EAA2E;AACzE;AACA;AACD;;AAED,UAAIC,mBAAmBH,gBAAgB,EAAvC;AACA,UAAII,qBAAqB,EAAzB;AACA,UAAIC,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkB3F,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAI4F,aAAa,KAAKzI,YAAL,CAAkB+C,OAAOC,QAAzB,GAAjB,EAAuD0F,MAA5D,EAAoE,EAAEJ,6BAA6B,CAACI,SAASD,WAAWvF,IAAX,EAAV,EAA6BC,IAA5D,CAApE,EAAuImF,6BAA6B,IAApK,EAA0K;AACxK,cAAIK,YAAYD,OAAOpI,KAAvB;;AAEA,cAAI,CAAC2H,aAAaV,QAAb,CAAsBoB,SAAtB,CAAL,EAAuC;AACrC;AACAN,+BAAmBzE,IAAnB,CAAwB+E,SAAxB;AACD,WAHD,MAGO;AACL;AACAP,+BAAmBA,iBAAiBpG,MAAjB,CAAwB,UAAU4G,SAAV,EAAqB;AAC9D,qBAAOA,aAAaD,SAApB;AACD,aAFkB,CAAnB;AAGD;AACF;AACF,OAdD,CAcE,OAAOtF,GAAP,EAAY;AACZkF,6BAAqB,IAArB;AACAC,0BAAkBnF,GAAlB;AACD,OAjBD,SAiBU;AACR,YAAI;AACF,cAAI,CAACiF,0BAAD,IAA+BG,WAAW,QAAX,KAAwB,IAA3D,EAAiE;AAC/DA,uBAAW,QAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIF,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;;AAED,UAAI,KAAK1I,cAAT,EAAyB;AACvBY,gBAAQC,GAAR,CAAY,sBAAZ,EAAoC0H,kBAApC;AACA3H,gBAAQC,GAAR,CAAY,oBAAZ,EAAkCyH,gBAAlC;AACD;;AAED,WAAK,IAAIS,KAAK,CAAT,EAAYC,sBAAsBT,kBAAvC,EAA2DQ,KAAKC,oBAAoBjK,MAApF,EAA4FgK,IAA5F,EAAkG;AAChG,YAAIE,QAAQD,oBAAoBD,EAApB,CAAZ;AACA,aAAKG,eAAL,CAAqBD,KAArB;AACD;;AAED,WAAK/I,YAAL,GAAoBiI,YAApB;AACA,UAAIgB,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkBtG,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAIuG,aAAahB,iBAAiBrF,OAAOC,QAAxB,GAAjB,EAAsDqG,MAA3D,EAAmE,EAAEJ,6BAA6B,CAACI,SAASD,WAAWlG,IAAX,EAAV,EAA6BC,IAA5D,CAAnE,EAAsI8F,6BAA6B,IAAnK,EAAyK;AACvK,cAAIK,MAAMD,OAAO/I,KAAjB;;AAEA,cAAI,CAACgJ,GAAL,EAAU;AACR;AACD;;AAED,cAAIC,OAAO1I,SAAS2I,aAAT,CAAuB,MAAvB,CAAX;AACAD,eAAKE,EAAL,GAAUC,KAAKJ,GAAL,CAAV;AACAC,eAAKI,IAAL,GAAYL,GAAZ;AACAC,eAAKpF,IAAL,GAAY,UAAZ;AACAoF,eAAKK,GAAL,GAAW,YAAX;AACAL,eAAKM,KAAL,GAAa,cAAb;AACAN,eAAKO,SAAL,GAAiB,cAAjB;AACAjJ,mBAASkJ,oBAAT,CAA8B,MAA9B,EAAsC,CAAtC,EAAyCC,WAAzC,CAAqDT,IAArD;AACD;AACF,OAjBD,CAiBE,OAAOlG,GAAP,EAAY;AACZ6F,6BAAqB,IAArB;AACAC,0BAAkB9F,GAAlB;AACD,OApBD,SAoBU;AACR,YAAI;AACF,cAAI,CAAC4F,0BAAD,IAA+BG,WAAW,QAAX,KAAwB,IAA3D,EAAiE;AAC/DA,uBAAW,QAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIF,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA7FA,GA/d4B,EA6jB5B;AACD/J,SAAK,oBADJ;AAEDkB,WAAO,SAAS2J,kBAAT,CAA4BX,GAA5B,EAAiC;AACtC,UAAIY,WAAWzF,MAAM0F,IAAN,CAAWtJ,SAASuJ,sBAAT,CAAgC,cAAhC,CAAX,EAA4DC,KAA5D,EAAf;AACA,aAAOH,SAASI,IAAT,CAAc,UAAUC,OAAV,EAAmB;AACtC;AACA,eAAOA,QAAQd,EAAR,IAAcC,KAAKJ,GAAL,CAArB;AACD,OAHM,CAAP;AAID;AARA,GA7jB4B,EAskB5B;AACDlK,SAAK,iBADJ;AAEDkB,WAAO,SAAS0I,eAAT,CAAyBM,GAAzB,EAA8B;AACnC,UAAIiB,UAAU,KAAKN,kBAAL,CAAwBX,GAAxB,CAAd;;AAEA,UAAIiB,OAAJ,EAAa;AACXA,gBAAQC,QAAR,GAAmB,IAAnB;AACAD,gBAAQE,UAAR,CAAmBC,WAAnB,CAA+BH,OAA/B;AACD;AACF;AACD;;AAEA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;;AApCC,GAtkB4B,EA4mB5B;AACDnL,SAAK,cADJ;AAEDkB,WAAO,SAASuD,YAAT,GAAwB;AAC7B,UAAI8G,SAASpJ,OAAOoJ,MAAP,IAAiBpJ,OAAOqJ,QAArC;;AAEA,UAAID,MAAJ,EAAY;AACV,YAAIE,MAAM,IAAIC,WAAJ,CAAgB,CAAhB,CAAV;AACAH,eAAOI,eAAP,CAAuBF,GAAvB;AACA,YAAIG,MAAM,CAAC,CAAX;AACA,eAAO,uCAAuCC,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AAC1EF;AACA,cAAIG,IAAIN,IAAIG,OAAO,CAAX,KAAiBA,MAAM,CAAN,GAAU,CAA3B,GAA+B,EAAvC;AACA,cAAII,IAAIF,KAAK,GAAL,GAAWC,CAAX,GAAeA,IAAI,GAAJ,GAAU,GAAjC;AACA,iBAAOC,EAAEjD,QAAF,CAAW,EAAX,CAAP;AACD,SALM,CAAP;AAMD,OAVD,MAUO;AACL,YAAIkD,IAAI,IAAIC,IAAJ,GAAWC,OAAX,EAAR;;AAEA,YAAIhK,OAAOiK,WAAP,IAAsB,OAAOjK,OAAOiK,WAAP,CAAmBC,GAA1B,KAAkC,UAA5D,EAAwE;AACtEJ,eAAKG,YAAYC,GAAZ,EAAL,CADsE,CAC9C;AACzB;;AAED,YAAIlJ,OAAO,uCAAuC0I,OAAvC,CAA+C,OAA/C,EAAwD,UAAUC,CAAV,EAAa;AAC9E,cAAIC,IAAI,CAACE,IAAIK,KAAKC,MAAL,KAAgB,EAArB,IAA2B,EAA3B,GAAgC,CAAxC;AACAN,cAAIK,KAAKE,KAAL,CAAWP,IAAI,EAAf,CAAJ;AACA,iBAAO,CAACH,KAAK,GAAL,GAAWC,CAAX,GAAeA,IAAI,GAAJ,GAAU,GAA1B,EAA+BhD,QAA/B,CAAwC,EAAxC,CAAP;AACD,SAJU,CAAX;AAKA,eAAO5F,IAAP;AACD;AACF;AA7BA,GA5mB4B,CAA/B;;AA4oBA,SAAO9C,gBAAP;AACD,CA7pBD,EAFA;;AAiqBA,IAAI,OAAOoM,MAAP,IAAiB,WAAjB,IAAgC,OAAOA,OAAOC,OAAd,IAAyB,WAA7D,EAA0E;AACxED,SAAOC,OAAP,GAAiBrM,gBAAjB;AACD;;AAED,IAAI8B,MAAJ,EAAY;AACVA,SAAO9B,gBAAP,GAA0BA,gBAA1B;AACD;AACD;AACA,CAAC;;AAEDP,OAAOC,cAAP,CAAsB2M,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CxL,SAAO;AADoC,CAA7C;AAGAwL,QAAQC,OAAR,GAAkBD,QAAQE,UAAR,GAAqBF,QAAQG,iBAAR,GAA4BH,QAAQI,KAAR,GAAgBJ,QAAQK,kBAAR,GAA6BL,QAAQM,KAAR,GAAgBN,QAAQO,MAAR,GAAiBP,QAAQQ,WAAR,GAAsBR,QAAQS,MAAR,GAAiBT,QAAQU,QAAR,GAAmBV,QAAQW,WAAR,GAAsB5J,SAAjO;;AAEA,IAAIxD,eAAe,YAAY;AAAE,WAASqN,gBAAT,CAA0BhO,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,UAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4BC,OAAOC,cAAP,CAAsBT,MAAtB,EAA8BI,WAAWM,GAAzC,EAA8CN,UAA9C;AAA4D;AAAE,GAAC,OAAO,UAAUP,WAAV,EAAuBe,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBoN,iBAAiBnO,YAAYiB,SAA7B,EAAwCF,UAAxC,EAAqD,IAAIC,WAAJ,EAAiBmN,iBAAiBnO,WAAjB,EAA8BgB,WAA9B,EAA4C,OAAOhB,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,IAAIoO,OAAO,SAASC,GAAT,CAAaC,MAAb,EAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;AAAE,MAAIF,WAAW,IAAf,EAAqBA,SAASG,SAASxN,SAAlB,CAA6B,IAAIyN,OAAO/N,OAAOgO,wBAAP,CAAgCL,MAAhC,EAAwCC,QAAxC,CAAX,CAA8D,IAAIG,SAASpK,SAAb,EAAwB;AAAE,QAAIoB,SAAS/E,OAAOiO,cAAP,CAAsBN,MAAtB,CAAb,CAA4C,IAAI5I,WAAW,IAAf,EAAqB;AAAE,aAAOpB,SAAP;AAAmB,KAA1C,MAAgD;AAAE,aAAO+J,IAAI3I,MAAJ,EAAY6I,QAAZ,EAAsBC,QAAtB,CAAP;AAAyC;AAAE,GAAnK,MAAyK,IAAI,WAAWE,IAAf,EAAqB;AAAE,WAAOA,KAAK3M,KAAZ;AAAoB,GAA3C,MAAiD;AAAE,QAAI8M,SAASH,KAAKL,GAAlB,CAAuB,IAAIQ,WAAWvK,SAAf,EAA0B;AAAE,aAAOA,SAAP;AAAmB,KAAC,OAAOuK,OAAOC,IAAP,CAAYN,QAAZ,CAAP;AAA+B;AAAE,CAA1e;;AAEA,IAAIO,kBAAkBC,QAAQ,kBAAR,CAAtB;;AAEA,SAASlP,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,oBAAoBC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIC,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASgP,0BAAT,CAAoCC,IAApC,EAA0CJ,IAA1C,EAAgD;AAAE,MAAI,CAACI,IAAL,EAAW;AAAE,UAAM,IAAIC,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF,GAAC,OAAOL,SAAS,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,UAArD,IAAmEA,IAAnE,GAA0EI,IAAjF;AAAwF;;AAEhP,SAASE,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,eAAe,IAAvD,EAA6D;AAAE,UAAM,IAAIrP,SAAJ,CAAc,qEAAoEqP,UAApE,yCAAoEA,UAApE,EAAd,CAAN;AAAsG,GAACD,SAASpO,SAAT,GAAqBN,OAAO4O,MAAP,CAAcD,cAAcA,WAAWrO,SAAvC,EAAkD,EAAEuO,aAAa,EAAEzN,OAAOsN,QAAT,EAAmB7O,YAAY,KAA/B,EAAsCE,UAAU,IAAhD,EAAsDD,cAAc,IAApE,EAAf,EAAlD,CAArB,CAAqK,IAAI6O,UAAJ,EAAgB3O,OAAO8O,cAAP,GAAwB9O,OAAO8O,cAAP,CAAsBJ,QAAtB,EAAgCC,UAAhC,CAAxB,GAAsED,SAASK,SAAT,GAAqBJ,UAA3F;AAAwG;;AAE9e,IAAIpB,cAAcX,QAAQW,WAAR,GAAsB,UAAUyB,OAAV,EAAmB;AACzDP,YAAUlB,WAAV,EAAuByB,OAAvB;;AAEA,WAASzB,WAAT,CAAqB0B,QAArB,EAA+B;AAC7B9P,oBAAgB,IAAhB,EAAsBoO,WAAtB;;AAEA;AACA;AACA0B,aAAS5M,MAAT,GAAkB,IAAlB;;AAEA,QAAIhB,QAAQiN,2BAA2B,IAA3B,EAAiC,CAACf,YAAYwB,SAAZ,IAAyB/O,OAAOiO,cAAP,CAAsBV,WAAtB,CAA1B,EAA8DY,IAA9D,CAAmE,IAAnE,EAAyEc,QAAzE,CAAjC,CAAZ;;AAEA,QAAI,CAAC5N,MAAMoB,aAAX,EAA0B;AACxBpB,YAAMoB,aAAN,GAAsB,EAAtB;AACD;;AAED,QAAI,CAACpB,MAAM6N,oBAAX,EAAiC;AAC/B7N,YAAM6N,oBAAN,GAA6B,EAA7B;AACD;;AAED,QAAI,CAAC7N,MAAM8N,iBAAX,EAA8B;AAC5B9N,YAAM8N,iBAAN,GAA0B,EAA1B;AACD;AACD,WAAO9N,KAAP;AACD;;AAEDlB,eAAaoN,WAAb,EAA0B,CAAC;AACzBrN,SAAK,6BADoB;AAEzBkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKF,YAAYjN,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBV,YAAYjN,SAAlC,CAAxC,EAAsF,6BAAtF,EAAqH,IAArH,EAA2H6N,IAA3H,CAAgI,IAAhI,EAAsItF,OAAtI;AACA;AACA;AACA;AACA;AACA,UAAI,CAACA,QAAQwG,UAAb,EAAyB;AACvB,aAAKC,UAAL,GAAkBzG,QAAQuB,GAA1B;AACD;;AAED;AACA,WAAKmF,SAAL,GAAiB1G,QAAQ0G,SAAzB;AACA,WAAKF,UAAL,GAAkBxG,QAAQwG,UAAR,IAAsBxG,QAAQuB,GAAhD;AACA,WAAKoF,WAAL,GAAmB3G,QAAQ2G,WAA3B;;AAEA,UAAI3G,QAAQ4G,WAAZ,EAAyB;AACvB,aAAKA,WAAL,GAAmB,IAAIrD,IAAJ,CAASvD,QAAQ4G,WAAjB,CAAnB;AACD;;AAED,WAAKC,IAAL,GAAY7G,QAAQ6G,IAApB;AACA,WAAKC,kBAAL,GAA0B9G,QAAQ8G,kBAAlC;;AAEA,WAAKC,YAAL,GAAoB/G,QAAQ+G,YAA5B;;AAEA;AACA,WAAKC,IAAL,GAAYhH,QAAQgH,IAApB;;AAEA,WAAKrP,WAAL,GAAmBqI,QAAQrI,WAA3B;AACA,UAAI,CAAC,KAAKA,WAAV,EAAuB;AACrB,aAAKA,WAAL,GAAmB,EAAnB;AACD;;AAED,WAAKsP,MAAL,GAAcjH,QAAQiH,MAAtB;;AAEA;AACA,WAAKrN,aAAL,GAAqBoG,QAAQpG,aAAR,IAAyB,EAA9C;;AAEA;AACA,WAAKyM,oBAAL,GAA4BrG,QAAQqG,oBAAR,IAAgC,EAA5D;;AAEA;AACA,WAAKC,iBAAL,GAAyBtG,QAAQsG,iBAAR,IAA6B,EAAtD;AACD;AA5CwB,GAAD,EA6CvB;AACDjP,SAAK,sBADJ;AAEDkB,WAAO,SAAS2O,oBAAT,GAAgC;AACrCtC,WAAKF,YAAYjN,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBV,YAAYjN,SAAlC,CAAxC,EAAsF,sBAAtF,EAA8G,IAA9G,EAAoH6N,IAApH,CAAyH,IAAzH;;AAEA,WAAK2B,MAAL,GAAc,KAAd;AACD;AANA,GA7CuB,EAoDvB;AACD5P,SAAK,iBADJ;AAEDkB,WAAO,SAAS4O,eAAT,GAA2B;AAChC,UAAI/I,SAAS;AACXqI,oBAAY,KAAKA,UADN;AAEXD,oBAAY,KAAKA,UAFN;AAGXE,mBAAW,KAAKA,SAHL;AAIXE,qBAAa,KAAKA,WAJP;AAKXD,qBAAa,KAAKA,WALP;AAMXE,cAAM,KAAKA,IANA;AAOXG,cAAM,KAAKA,IAPA;AAQXD,sBAAc,KAAKA,YARR;AASXpP,qBAAa,KAAKA,WATP;AAUXsP,gBAAQ,KAAKA,MAVF;AAWXH,4BAAoB,KAAKA,kBAXd;AAYXlN,uBAAe,KAAKA,aAZT;AAaXyM,8BAAsB,KAAKA,oBAbhB;AAcXC,2BAAmB,KAAKA;AAdb,OAAb;;AAiBA,UAAIc,cAAcxC,KAAKF,YAAYjN,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBV,YAAYjN,SAAlC,CAAxC,EAAsF,iBAAtF,EAAyG,IAAzG,EAA+G6N,IAA/G,CAAoH,IAApH,CAAlB;AACAnO,aAAOyI,MAAP,CAAcwH,WAAd,EAA2BhJ,MAA3B;AACA,aAAOgJ,WAAP;AACD;AAvBA,GApDuB,EA4EvB;AACD/P,SAAK,UADJ;AAEDkB,WAAO,SAAS8O,QAAT,GAAoB;AACzB,aAAO,KAAKL,IAAL,IAAa,eAApB;AACD;AAJA,GA5EuB,EAiFvB;AACD3P,SAAK,SADJ;AAEDkB,WAAO,SAAS+O,OAAT,GAAmB;AACxB,aAAO,KAAKrJ,YAAL,IAAqB,UAArB,IAAmC,KAAK+I,IAAL,IAAa,QAAvD;AACD;AAJA,GAjFuB,EAsFvB;AACD3P,SAAK,iBADJ;AAEDkB,WAAO,SAASgP,eAAT,GAA2B;AAChC,aAAO,KAAKC,cAAL,CAAoB,eAApB,KAAwC,IAA/C;AACD;AAJA,GAtFuB,EA2FvB;AACDnQ,SAAK,aADJ;AAEDkB,WAAO,SAASkP,WAAT,CAAqBC,IAArB,EAA2B;AAChC,WAAKC,cAAL,CAAoB,UAApB,EAAgCD,IAAhC;AACD;AAJA,GA3FuB,EAgGvB;AACDrQ,SAAK,aADJ;AAEDkB,WAAO,SAASqP,WAAT,GAAuB;AAC5B,aAAO,KAAKJ,cAAL,CAAoB,UAApB,CAAP;AACD;AAJA,GAhGuB,EAqGvB;AACDnQ,SAAK,eADJ;AAEDkB,WAAO,SAASP,aAAT,GAAyB;AAC9B,UAAI,KAAKgI,OAAL,CAAa+G,YAAb,IAA6B,mBAAmB,KAAK/G,OAAL,CAAa+G,YAAjE,EAA+E;AAC7E,eAAO,KAAK/G,OAAL,CAAa+G,YAAb,CAA0B/O,aAAjC;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;AATC,GArGuB,EAmHvB;AACDX,SAAK,kBADJ;AAEDkB,WAAO,SAASsP,gBAAT,GAA4B;AACjC,UAAI,KAAKpB,UAAT,EAAqB;AACnB,eAAO,KAAKA,UAAZ;AACD,OAFD,MAEO;AACL,eAAO,KAAKjM,IAAZ;AACD;AACF;AARA,GAnHuB,EA4HvB;AACDnD,SAAK,mBADJ;AAEDkB,WAAO,SAASuP,iBAAT,GAA6B;AAClC,aAAO,KAAKtB,UAAL,IAAmB,KAAKC,UAA/B;AACD;AAJA,GA5HuB,EAiIvB;AACDpP,SAAK,yCADJ;AAEDkB,WAAO,SAASwP,uCAAT,GAAmD;AACxD,aAAO,CAAC,QAAD,EAAW,sBAAX,EAAmC,mBAAnC,EAAwDtI,MAAxD,CAA+DmF,KAAKF,YAAYjN,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBV,YAAYjN,SAAlC,CAAxC,EAAsF,yCAAtF,EAAiI,IAAjI,EAAuI6N,IAAvI,CAA4I,IAA5I,CAA/D,CAAP;AACD;;AAED;;;;;AANC,GAjIuB,EA4IvB;AACDjO,SAAK,eADJ;AAEDkB,WAAO,SAASyP,aAAT,GAAyB;AAC9B,aAAOC,UAAUC,gBAAV,GAA6B1I,QAA7B,CAAsC,KAAKwH,IAA3C,CAAP;AACD;AAJA,GA5IuB,EAiJvB;AACD3P,SAAK,mBADJ;AAEDkB,WAAO,SAAS4P,iBAAT,CAA2BnL,IAA3B,EAAiC;AACtC,WAAKsJ,iBAAL,CAAuBzK,IAAvB,CAA4BmB,KAAKxC,IAAjC;AACD;AAJA,GAjJuB,EAsJvB;AACDnD,SAAK,4BADJ;AAEDkB,WAAO,SAAS6P,0BAAT,CAAoCpL,IAApC,EAA0C;AAC/C,aAAO,KAAKsJ,iBAAL,CAAuB+B,OAAvB,CAA+BrL,KAAKxC,IAApC,MAA8C,CAAC,CAAtD;AACD;AAJA,GAtJuB,EA2JvB;AACDnD,SAAK,6BADJ;AAEDkB,WAAO,SAAS+P,2BAAT,CAAqCtL,IAArC,EAA2C;AAChD,aAAO,KAAKqJ,oBAAL,CAA0BgC,OAA1B,CAAkCrL,KAAKxC,IAAvC,MAAiD,CAAC,CAAzD;AACD;AAJA,GA3JuB,EAgKvB;AACDnD,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,cAAP;AACD;AAJA,GAhKuB,CAA1B,EAqKI,CAAC;AACHxN,SAAK,kBADF;AAEHkB,WAAO,SAAS2P,gBAAT,GAA4B;AACjC,aAAO,CAAC,eAAD,CAAP;AACD;AAJE,GAAD,CArKJ;;AA4KA,SAAOxD,WAAP;AACD,CAvMuC,CAuMtCa,gBAAgBgD,MAvMsB,CAAxC;;AAyMA;AACA,IAAI9D,WAAWV,QAAQU,QAAR,GAAmB,UAAU+D,QAAV,EAAoB;AACpD5C,YAAUnB,QAAV,EAAoB+D,QAApB;;AAEA,WAAS/D,QAAT,CAAkB2B,QAAlB,EAA4B;AAC1B9P,oBAAgB,IAAhB,EAAsBmO,QAAtB;;AAEA,QAAI1H,SAAS0I,2BAA2B,IAA3B,EAAiC,CAAChB,SAASyB,SAAT,IAAsB/O,OAAOiO,cAAP,CAAsBX,QAAtB,CAAvB,EAAwDa,IAAxD,CAA6D,IAA7D,EAAmEc,QAAnE,CAAjC,CAAb;;AAEA,QAAI,CAACrJ,OAAO0L,KAAZ,EAAmB;AACjB1L,aAAO0L,KAAP,GAAe,EAAf;AACD;AACD,QAAI,CAAC1L,OAAOlE,IAAZ,EAAkB;AAChBkE,aAAOlE,IAAP,GAAc,EAAd;AACD;AACD,WAAOkE,MAAP;AACD;;AAEDzF,eAAamN,QAAb,EAAuB,CAAC;AACtBpN,SAAK,6BADiB;AAEtBkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,6BAAhF,EAA+G,IAA/G,EAAqH6N,IAArH,CAA0H,IAA1H,EAAgItF,OAAhI;AACA,WAAKuB,GAAL,GAAWvB,QAAQuB,GAAnB;AACA,WAAKsF,IAAL,GAAY7G,QAAQ6G,IAApB;AACA,WAAKhO,IAAL,GAAYmH,QAAQnH,IAAR,IAAgB,EAA5B;AACA,WAAK6P,OAAL,GAAe1I,QAAQ0I,OAAvB;AACA,WAAKC,YAAL,GAAoB3I,QAAQ2I,YAA5B;AACD;AATqB,GAAD,EAUpB;AACDtR,SAAK,iBADJ;AAEDkB,WAAO,SAAS4O,eAAT,GAA2B;AAChC,UAAI/I,SAAS;AACXmD,aAAK,KAAKA,GADC;AAEXsF,cAAM,KAAKA,IAFA;AAGXhO,cAAM,KAAKA,IAHA;AAIX6P,iBAAS,KAAKA,OAJH;AAKXC,sBAAc,KAAKA;AALR,OAAb;;AAQA,UAAIvB,cAAcxC,KAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,iBAAhF,EAAmG,IAAnG,EAAyG6N,IAAzG,CAA8G,IAA9G,CAAlB;AACAnO,aAAOyI,MAAP,CAAcwH,WAAd,EAA2BhJ,MAA3B;AACA,aAAOgJ,WAAP;AACD;AAdA,GAVoB,EAyBpB;AACD/P,SAAK,iBADJ;AAEDkB,WAAO,SAASqQ,eAAT,GAA2B;AAChC,UAAIC,aAAaC,EAAEhL,GAAF,CAAM,KAAK2K,KAAX,EAAkB,UAAUM,IAAV,EAAgB;AACjD,eAAO,EAAEvO,MAAMuO,KAAKvO,IAAb,EAAmByD,cAAc8K,KAAK9K,YAAtC,EAAP;AACD,OAFgB,CAAjB;;AAIA,aAAO4K,UAAP;AACD;AARA,GAzBoB,EAkCpB;AACDxR,SAAK,uBADJ;AAEDkB,WAAO,SAASyQ,qBAAT,CAA+BhM,IAA/B,EAAqC;AAC1C,UAAIA,KAAKiB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B,YAAI,CAAC6K,EAAEvG,IAAF,CAAO,KAAKkG,KAAZ,EAAmBzL,IAAnB,CAAL,EAA+B;AAC7B,eAAKyL,KAAL,CAAW5M,IAAX,CAAgBmB,IAAhB;AACD;AACF;AACD4H,WAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,uBAAhF,EAAyG,IAAzG,EAA+G6N,IAA/G,CAAoH,IAApH,EAA0HtI,IAA1H;AACD;AATA,GAlCoB,EA4CpB;AACD3F,SAAK,0BADJ;AAEDkB,WAAO,SAAS0Q,wBAAT,CAAkCjM,IAAlC,EAAwC;AAC7C,UAAIA,KAAKiB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B6K,UAAEI,IAAF,CAAO,KAAKT,KAAZ,EAAmBzL,IAAnB;AACD;AACD4H,WAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,0BAAhF,EAA4G,IAA5G,EAAkH6N,IAAlH,CAAuH,IAAvH,EAA6HtI,IAA7H;AACD;AAPA,GA5CoB,EAoDpB;AACD3F,SAAK,gCADJ;AAEDkB,WAAO,SAAS4Q,8BAAT,GAA0C;AAC/CvE,WAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,gCAAhF,EAAkH,IAAlH,EAAwH6N,IAAxH,CAA6H,IAA7H;AACA,WAAKmD,KAAL,GAAa,EAAb;AACD;AALA,GApDoB,EA0DpB;AACDpR,SAAK,8BADJ;AAEDkB,WAAO,SAAS6Q,4BAAT,CAAsCP,UAAtC,EAAkD;AACvDjE,WAAKH,SAAShN,SAAT,CAAmByO,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBX,SAAShN,SAA/B,CAArC,EAAgF,8BAAhF,EAAgH,IAAhH,EAAsH6N,IAAtH,CAA2H,IAA3H,EAAiIuD,UAAjI;;AAEA,UAAIQ,QAAQR,WAAW/K,GAAX,CAAe,UAAUwL,GAAV,EAAe;AACxC,eAAOA,IAAI9O,IAAX;AACD,OAFW,CAAZ;AAGA,WAAKiO,KAAL,CAAWc,OAAX,CAAmB,UAAUR,IAAV,EAAgB;AACjC,YAAI,CAACM,MAAM7J,QAAN,CAAeuJ,KAAKvO,IAApB,CAAL,EAAgC;AAC9BsO,YAAEU,MAAF,CAAS,KAAKf,KAAd,EAAqB,EAAEjO,MAAMuO,KAAKvO,IAAb,EAArB;AACD;AACF,OAJkB,CAIjB+B,IAJiB,CAIZ,IAJY,CAAnB;AAKD;AAbA,GA1DoB,EAwEpB;AACDlF,SAAK,0CADJ;AAEDkB,WAAO,SAASkR,wCAAT,CAAkDC,OAAlD,EAA2DC,OAA3D,EAAoEC,OAApE,EAA6E;AAClF,UAAIF,QAAQzL,YAAR,KAAyB,MAAzB,IAAmC6K,EAAEvG,IAAF,CAAO,KAAKkG,KAAZ,EAAmB,EAAEjO,MAAMmP,OAAR,EAAnB,CAAvC,EAA8E;AAC5Eb,UAAEU,MAAF,CAAS,KAAKf,KAAd,EAAqB,EAAEjO,MAAMmP,OAAR,EAArB;AACA,aAAKlB,KAAL,CAAW5M,IAAX,CAAgB6N,OAAhB;AACD;AACF;AAPA,GAxEoB,EAgFpB;AACDrS,SAAK,SADJ;AAEDkB,WAAO,SAASsR,OAAT,CAAiBxS,GAAjB,EAAsBkB,KAAtB,EAA6B;AAClC,UAAIuR,iBAAiB1Q,KAAK6C,SAAL,CAAe,KAAKpD,IAAL,CAAUxB,GAAV,CAAf,MAAmC+B,KAAK6C,SAAL,CAAe1D,KAAf,CAAxD;AACA,UAAIuR,cAAJ,EAAoB;AAClB,aAAKjR,IAAL,CAAUxB,GAAV,IAAiBkB,KAAjB;AACA,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;AATA,GAhFoB,EA0FpB;AACDlB,SAAK,YADJ;AAEDkB,WAAO,SAASwR,UAAT,CAAoB1S,GAApB,EAAyB;AAC9B,aAAO,KAAKwB,IAAL,CAAUxB,GAAV,KAAkB,EAAzB;AACD;AAJA,GA1FoB,EA+FpB;AACDA,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,WAAP;AACD;AAJA,GA/FoB,CAAvB;;AAsGA,SAAOJ,QAAP;AACD,CAxHiC,CAwHhCc,gBAAgBgD,MAxHgB,CAAlC;;AA0HA;AACA,IAAI/D,SAAST,QAAQS,MAAR,GAAiB,SAASA,MAAT,CAAgBwF,IAAhB,EAAsB;AAClD1T,kBAAgB,IAAhB,EAAsBkO,MAAtB;;AAEAsE,IAAEmB,KAAF,CAAQ,IAAR,EAAcD,IAAd;AACA,OAAKE,OAAL,GAAe,KAAf,CAJkD,CAI5B;AACtB,OAAKC,KAAL,GAAa,KAAb;AACA,MAAI,KAAKC,YAAT,EAAuB;AACrB;AACA,SAAKA,YAAL,GAAoB,IAAI7G,IAAJ,CAAS,KAAK6G,YAAd,CAApB;AACD;AACF,CAVD;;AAYA,IAAI7F,cAAcR,QAAQQ,WAAR,GAAsB,UAAU8F,QAAV,EAAoB;AAC1DzE,YAAUrB,WAAV,EAAuB8F,QAAvB;;AAEA,WAAS9F,WAAT,CAAqByF,IAArB,EAA2B;AACzB1T,oBAAgB,IAAhB,EAAsBiO,WAAtB;;AAEA,QAAI3G,SAAS6H,2BAA2B,IAA3B,EAAiC,CAAClB,YAAY2B,SAAZ,IAAyB/O,OAAOiO,cAAP,CAAsBb,WAAtB,CAA1B,EAA8De,IAA9D,CAAmE,IAAnE,EAAyE0E,IAAzE,CAAjC,CAAb;;AAEA,QAAIA,KAAKM,OAAT,EAAkB;AAChB1M,aAAO0M,OAAP,GAAiBN,KAAKM,OAAL,CAAaxM,GAAb,CAAiB,UAAUpE,MAAV,EAAkB;AAClD,eAAO,IAAI8K,MAAJ,CAAW9K,MAAX,CAAP;AACD,OAFgB,CAAjB;AAGD;;AAED,QAAI,CAACkE,OAAO0M,OAAZ,EAAqB;AACnB1M,aAAO0M,OAAP,GAAiB,EAAjB;AACD;AACD,WAAO1M,MAAP;AACD;;AAEDtG,eAAaiN,WAAb,EAA0B,CAAC;AACzBlN,SAAK,2BADoB;AAEzBkB,WAAO,SAASgS,yBAAT,CAAmCvN,IAAnC,EAAyC;AAC9C,aAAO,KAAKsN,OAAL,CAAarQ,MAAb,CAAoB,UAAUP,MAAV,EAAkB;AAC3C,eAAOA,OAAO8Q,OAAP,IAAkBxN,KAAKiB,YAAvB,IAAuCvE,OAAO8Q,OAAP,IAAkB,MAAhE;AACD,OAFM,CAAP;AAGD;AANwB,GAAD,EAOvB;AACDnT,SAAK,6BADJ;AAEDkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKL,YAAY9M,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBb,YAAY9M,SAAlC,CAAxC,EAAsF,6BAAtF,EAAqH,IAArH,EAA2H6N,IAA3H,CAAgI,IAAhI,EAAsItF,OAAtI;AACA,WAAKyK,WAAL,GAAmBzK,QAAQyK,WAA3B;AACA,WAAKlJ,GAAL,GAAWvB,QAAQuB,GAAnB;AACA,WAAKsF,IAAL,GAAY7G,QAAQ6G,IAApB;AACA,WAAKE,YAAL,GAAoB/G,QAAQ+G,YAA5B;AACA,WAAK2D,eAAL,GAAuB1K,QAAQ0K,eAA/B;AACA,UAAI1K,QAAQsK,OAAZ,EAAqB;AACnB,aAAKA,OAAL,GAAetK,QAAQsK,OAAR,CAAgBxM,GAAhB,CAAoB,UAAUpE,MAAV,EAAkB;AACnD,iBAAO,IAAI8K,MAAJ,CAAW9K,MAAX,CAAP;AACD,SAFc,CAAf;AAGD;AACF;AAdA,GAPuB,EAsBvB;AACDrC,SAAK,iBADJ;AAEDkB,WAAO,SAAS4O,eAAT,GAA2B;AAChC,UAAI/I,SAAS;AACXyI,cAAM,KAAKA,IADA;AAEXtF,aAAK,KAAKA,GAFC;AAGXwF,sBAAc,KAAKA,YAHR;AAIX0D,qBAAa,KAAKA,WAJP;AAKXH,iBAAS,KAAKA,OAAL,CAAaxM,GAAb,CAAiB,UAAU6M,CAAV,EAAa;AACrC,iBAAO7B,EAAE8B,IAAF,CAAOD,CAAP,EAAU,CAAC,SAAD,EAAY,YAAZ,CAAV,CAAP;AACD,SAFQ,CALE;AAQXD,yBAAiB,KAAKA;AARX,OAAb;;AAWA,UAAItD,cAAcxC,KAAKL,YAAY9M,SAAZ,CAAsByO,SAAtB,IAAmC/O,OAAOiO,cAAP,CAAsBb,YAAY9M,SAAlC,CAAxC,EAAsF,iBAAtF,EAAyG,IAAzG,EAA+G6N,IAA/G,CAAoH,IAApH,CAAlB;AACAnO,aAAOyI,MAAP,CAAcwH,WAAd,EAA2BhJ,MAA3B;AACA,aAAOgJ,WAAP;AACD;AAjBA,GAtBuB,EAwCvB;AACD/P,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,WAAP;AACD;AAJA,GAxCuB,CAA1B;;AA+CA,SAAON,WAAP;AACD,CApEuC,CAoEtCgB,gBAAgBgD,MApEsB,CAAxC;;AAsEA;AACA,IAAIjE,SAASP,QAAQO,MAAR,GAAiB,UAAUuG,QAAV,EAAoB;AAChDjF,YAAUtB,MAAV,EAAkBuG,QAAlB;;AAEA,WAASvG,MAAT,CAAgB8B,QAAhB,EAA0B;AACxB9P,oBAAgB,IAAhB,EAAsBgO,MAAtB;;AAEA,QAAIlF,SAASqG,2BAA2B,IAA3B,EAAiC,CAACnB,OAAO4B,SAAP,IAAoB/O,OAAOiO,cAAP,CAAsBd,MAAtB,CAArB,EAAoDgB,IAApD,CAAyD,IAAzD,EAA+Dc,QAA/D,CAAjC,CAAb;;AAEA,QAAI,CAAChH,OAAO0L,IAAZ,EAAkB;AAChB;AACA;AACA;AACA1L,aAAO0L,IAAP,GAAc,EAAd;AACD;;AAED,QAAI,CAAC1L,OAAO2L,IAAZ,EAAkB;AAChB3L,aAAO2L,IAAP,GAAc,EAAd;AACD;AACD,WAAO3L,MAAP;AACD;;AAED9H,eAAagN,MAAb,EAAqB,CAAC;AACpBjN,SAAK,6BADe;AAEpBkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,6BAA5E,EAA2G,IAA3G,EAAiH6N,IAAjH,CAAsH,IAAtH,EAA4HtF,OAA5H;AACA,WAAKgL,KAAL,GAAahL,QAAQgL,KAArB;AACA,WAAKF,IAAL,GAAY9K,QAAQ8K,IAApB;AACD;AANmB,GAAD,EAOlB;AACDzT,SAAK,iBADJ;AAEDkB,WAAO,SAAS4O,eAAT,GAA2B;AAChC,UAAI/I,SAAS;AACX4M,eAAO,KAAKA,KADD;AAEXF,cAAM,KAAKA;AAFA,OAAb;;AAKA,UAAI1D,cAAcxC,KAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,iBAA5E,EAA+F,IAA/F,EAAqG6N,IAArG,CAA0G,IAA1G,CAAlB;AACAnO,aAAOyI,MAAP,CAAcwH,WAAd,EAA2BhJ,MAA3B;AACA,aAAOgJ,WAAP;AACD;AAXA,GAPkB,EAmBlB;AACD/P,SAAK,uBADJ;AAEDkB,WAAO,SAASyQ,qBAAT,CAA+BhM,IAA/B,EAAqC;AAC1C;;;;;;;AAOA,UAAIA,KAAKiB,YAAL,IAAqB,KAAzB,EAAgC;AAC9BjB,aAAKgM,qBAAL,CAA2B,IAA3B;AACD;AACDpE,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,uBAA5E,EAAqG,IAArG,EAA2G6N,IAA3G,CAAgH,IAAhH,EAAsHtI,IAAtH;AACD;AAdA,GAnBkB,EAkClB;AACD3F,SAAK,wBADJ;AAEDkB,WAAO,SAAS0S,sBAAT,CAAgCjO,IAAhC,EAAsC;AAC3C4H,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,wBAA5E,EAAsG,IAAtG,EAA4G6N,IAA5G,CAAiH,IAAjH,EAAuHtI,IAAvH;AACA,WAAKkO,oBAAL;AACD;AALA,GAlCkB,EAwClB;AACD7T,SAAK,gCADJ;AAEDkB,WAAO,SAAS4S,8BAAT,CAAwCnO,IAAxC,EAA8C;AACnD4H,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,gCAA5E,EAA8G,IAA9G,EAAoH6N,IAApH,CAAyH,IAAzH,EAA+HtI,IAA/H;AACA,WAAKkO,oBAAL;AACD;AALA,GAxCkB,EA8ClB;AACD7T,SAAK,uBADJ;AAEDkB,WAAO,SAAS6S,qBAAT,GAAiC;AACtC,WAAKL,IAAL,CAAUxB,OAAV,CAAkB,UAAU8B,GAAV,EAAe;AAC/BvC,UAAEU,MAAF,CAAS6B,IAAI5C,KAAb,EAAoB,EAAEjO,MAAM,KAAKA,IAAb,EAApB;AACD,OAFiB,CAEhB+B,IAFgB,CAEX,IAFW,CAAlB;AAGAqI,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,uBAA5E,EAAqG,IAArG,EAA2G6N,IAA3G,CAAgH,IAAhH;AACD;AAPA,GA9CkB,EAsDlB;AACDjO,SAAK,8BADJ;AAEDkB,WAAO,SAAS+S,4BAAT,CAAsC3B,OAAtC,EAA+CC,OAA/C,EAAwD;AAC7DhF,WAAKN,OAAO7M,SAAP,CAAiByO,SAAjB,IAA8B/O,OAAOiO,cAAP,CAAsBd,OAAO7M,SAA7B,CAAnC,EAA4E,8BAA5E,EAA4G,IAA5G,EAAkH6N,IAAlH,CAAuH,IAAvH;AACA,UAAI3K,4BAA4B,IAAhC;AACA,UAAIC,oBAAoB,KAAxB;AACA,UAAIC,iBAAiBC,SAArB;;AAEA,UAAI;AACF,aAAK,IAAIC,YAAY,KAAKgQ,IAAL,CAAU/P,OAAOC,QAAjB,GAAhB,EAA8CC,KAAnD,EAA0D,EAAEP,4BAA4B,CAACO,QAAQH,UAAUI,IAAV,EAAT,EAA2BC,IAAzD,CAA1D,EAA0HT,4BAA4B,IAAtJ,EAA4J;AAC1J,cAAI0Q,MAAMnQ,MAAM3C,KAAhB;;AAEAuQ,YAAEU,MAAF,CAAS6B,IAAI5C,KAAb,EAAoB,EAAEjO,MAAMmP,OAAR,EAApB;AACA0B,cAAI5C,KAAJ,CAAU5M,IAAV,CAAe,IAAf;AACD;AACF,OAPD,CAOE,OAAOP,GAAP,EAAY;AACZV,4BAAoB,IAApB;AACAC,yBAAiBS,GAAjB;AACD,OAVD,SAUU;AACR,YAAI;AACF,cAAI,CAACX,yBAAD,IAA8BI,UAAUwQ,MAA5C,EAAoD;AAClDxQ,sBAAUwQ,MAAV;AACD;AACF,SAJD,SAIU;AACR,cAAI3Q,iBAAJ,EAAuB;AACrB,kBAAMC,cAAN;AACD;AACF;AACF;AACF;AA7BA,GAtDkB,EAoFlB;AACDxD,SAAK,qBADJ;AAEDkB,WAAO,SAASiT,mBAAT,CAA6BH,GAA7B,EAAkC;AACvC,WAAKH,oBAAL;AACD;AAJA,GApFkB,EAyFlB;AACD7T,SAAK,UADJ;AAEDkB,WAAO,SAASkT,QAAT,GAAoB;AACzB,aAAO,KAAKX,IAAL,IAAa,EAApB;AACD;AAJA,GAzFkB,EA8FlB;AACDzT,SAAK,WADJ;AAEDkB,WAAO,SAASmT,SAAT,GAAqB;AAC1B,aAAO,KAAKV,KAAL,IAAc,EAArB;AACD;AAJA,GA9FkB,EAmGlB;AACD3T,SAAK,sBADJ;AAEDkB,WAAO,SAAS2S,oBAAT,GAAgC;AACrC,WAAKS,eAAL,GAAuB,IAAvB;AACD;AAJA,GAnGkB,EAwGlB;AACDtU,SAAK,YADJ;AAEDkB,WAAO,SAASqT,UAAT,GAAsB;AAC3B,WAAKD,eAAL,GAAuBtH,MAAMwH,oBAAN,CAA2B,KAAKd,IAAhC,CAAvB;AACA,aAAO,KAAKY,eAAZ;AACD;AALA,GAxGkB,EA8GlB;AACDtU,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,MAAP;AACD;AAJA,GA9GkB,EAmHlB;AACDxN,SAAK,aADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,MAAP;AACD;AAJA,GAnHkB,CAArB,EAwHI,CAAC;AACHxN,SAAK,kBADF;AAEHkB,WAAO,SAASuT,gBAAT,CAA0BrD,KAA1B,EAAiC;AACtC,UAAIsD,WAAWtD,MAAMxO,MAAN,CAAa,UAAU8O,IAAV,EAAgB;AAC1C,eAAOA,KAAKiD,KAAL,IAAc,KAAd,IAAuBjD,KAAKiD,KAAL,IAAc,IAA5C;AACD,OAFc,CAAf;AAGA,aAAOD,QAAP;AACD;AAPE,GAAD,CAxHJ;;AAkIA,SAAOzH,MAAP;AACD,CAxJ6B,CAwJ5BiB,gBAAgBgD,MAxJY,CAA9B;;AA0JA;AACA,IAAIlE,QAAQN,QAAQM,KAAR,GAAgB,UAAU4H,QAAV,EAAoB;AAC9CrG,YAAUvB,KAAV,EAAiB4H,QAAjB;;AAEA,WAAS5H,KAAT,CAAe+B,QAAf,EAAyB;AACvB9P,oBAAgB,IAAhB,EAAsB+N,KAAtB;;AAEA,QAAI6H,SAASzG,2BAA2B,IAA3B,EAAiC,CAACpB,MAAM6B,SAAN,IAAmB/O,OAAOiO,cAAP,CAAsBf,KAAtB,CAApB,EAAkDiB,IAAlD,CAAuD,IAAvD,EAA6Dc,QAA7D,CAAjC,CAAb;;AAEA,QAAI,CAAC8F,OAAOjO,YAAZ,EAA0B;AACxBiO,aAAOjO,YAAP,GAAsB,KAAtB;AACD;;AAED,QAAI,CAACiO,OAAOzD,KAAZ,EAAmB;AACjByD,aAAOzD,KAAP,GAAe,EAAf;AACD;AACD,WAAOyD,MAAP;AACD;;AAED5U,eAAa+M,KAAb,EAAoB,CAAC;AACnBhN,SAAK,6BADc;AAEnBkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKP,MAAM5M,SAAN,CAAgByO,SAAhB,IAA6B/O,OAAOiO,cAAP,CAAsBf,MAAM5M,SAA5B,CAAlC,EAA0E,6BAA1E,EAAyG,IAAzG,EAA+G6N,IAA/G,CAAoH,IAApH,EAA0HtF,OAA1H;AACA,WAAKgL,KAAL,GAAahL,QAAQgL,KAArB;AACD;AALkB,GAAD,EAMjB;AACD3T,SAAK,iBADJ;AAEDkB,WAAO,SAAS4O,eAAT,GAA2B;AAChC,UAAI/I,SAAS;AACX4M,eAAO,KAAKA;AADD,OAAb;;AAIA,UAAI5D,cAAcxC,KAAKP,MAAM5M,SAAN,CAAgByO,SAAhB,IAA6B/O,OAAOiO,cAAP,CAAsBf,MAAM5M,SAA5B,CAAlC,EAA0E,iBAA1E,EAA6F,IAA7F,EAAmG6N,IAAnG,CAAwG,IAAxG,CAAlB;AACAnO,aAAOyI,MAAP,CAAcwH,WAAd,EAA2BhJ,MAA3B;AACA,aAAOgJ,WAAP;AACD;AAVA,GANiB,EAiBjB;AACD/P,SAAK,uBADJ;AAEDkB,WAAO,SAASyQ,qBAAT,CAA+BhM,IAA/B,EAAqC;AAC1C,UAAIA,KAAKiB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B,YAAI,CAAC6K,EAAEvG,IAAF,CAAO,KAAKkG,KAAZ,EAAmB,EAAEjO,MAAMwC,KAAKxC,IAAb,EAAnB,CAAL,EAA8C;AAC5C,eAAKiO,KAAL,CAAW5M,IAAX,CAAgBmB,IAAhB;AACAA,eAAK+N,IAAL,CAAUlP,IAAV,CAAe,IAAf;AACD;AACF;AACD+I,WAAKP,MAAM5M,SAAN,CAAgByO,SAAhB,IAA6B/O,OAAOiO,cAAP,CAAsBf,MAAM5M,SAA5B,CAAlC,EAA0E,uBAA1E,EAAmG,IAAnG,EAAyG6N,IAAzG,CAA8G,IAA9G,EAAoHtI,IAApH;AACD;AAVA,GAjBiB,EA4BjB;AACD3F,SAAK,0BADJ;AAEDkB,WAAO,SAAS0Q,wBAAT,CAAkCjM,IAAlC,EAAwC;AAC7C,UAAIA,KAAKiB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B6K,UAAEU,MAAF,CAAS,KAAKf,KAAd,EAAqB,EAAEjO,MAAMwC,KAAKxC,IAAb,EAArB;AACAsO,UAAEU,MAAF,CAASxM,KAAK+N,IAAd,EAAoB,EAAEvQ,MAAM,KAAKA,IAAb,EAApB;AACD;AACDoK,WAAKP,MAAM5M,SAAN,CAAgByO,SAAhB,IAA6B/O,OAAOiO,cAAP,CAAsBf,MAAM5M,SAA5B,CAAlC,EAA0E,0BAA1E,EAAsG,IAAtG,EAA4G6N,IAA5G,CAAiH,IAAjH,EAAuHtI,IAAvH;AACD;AARA,GA5BiB,EAqCjB;AACD3F,SAAK,0BADJ;AAEDkB,WAAO,SAAS4T,wBAAT,GAAoC;AACzC,UAAItD,aAAa,KAAK7I,OAAL,CAAa6I,UAA9B;;AAEA,UAAIQ,QAAQR,WAAW/K,GAAX,CAAe,UAAUwL,GAAV,EAAe;AACxC,eAAOA,IAAI9O,IAAX;AACD,OAFW,CAAZ;AAGA,WAAKiO,KAAL,CAAWnG,KAAX,GAAmBiH,OAAnB,CAA2B,UAAUR,IAAV,EAAgB;AACzC,YAAI,CAACM,MAAM7J,QAAN,CAAeuJ,KAAKvO,IAApB,CAAL,EAAgC;AAC9BsO,YAAEU,MAAF,CAAST,KAAKgC,IAAd,EAAoB,EAAEvQ,MAAM,KAAKA,IAAb,EAApB;AACAsO,YAAEU,MAAF,CAAS,KAAKf,KAAd,EAAqB,EAAEjO,MAAMuO,KAAKvO,IAAb,EAArB;;AAEAuO,eAAKoC,8BAAL,CAAoC,IAApC;AACD;AACF,OAP0B,CAOzB5O,IAPyB,CAOpB,IAPoB,CAA3B;AAQD;AAhBA,GArCiB,EAsDjB;AACDlF,SAAK,uBADJ;AAEDkB,WAAO,SAAS6S,qBAAT,GAAiC;AACtC,UAAIgB,SAAS,IAAb;;AAEA,WAAK3D,KAAL,CAAWc,OAAX,CAAmB,UAAUR,IAAV,EAAgB;AACjCD,UAAEU,MAAF,CAAST,KAAKgC,IAAd,EAAoB,EAAEvQ,MAAM4R,OAAO5R,IAAf,EAApB;AACAuO,aAAKoC,8BAAL,CAAoCiB,MAApC;AACD,OAHD;;AAKA,WAAK3D,KAAL,CAAW3R,MAAX,GAAoB,CAApB;;AAEA8N,WAAKP,MAAM5M,SAAN,CAAgByO,SAAhB,IAA6B/O,OAAOiO,cAAP,CAAsBf,MAAM5M,SAA5B,CAAlC,EAA0E,uBAA1E,EAAmG,IAAnG,EAAyG6N,IAAzG,CAA8G,IAA9G;AACD;AAbA,GAtDiB,EAoEjB;AACDjO,SAAK,8BADJ;AAEDkB,WAAO,SAAS+S,4BAAT,CAAsC3B,OAAtC,EAA+CC,OAA/C,EAAwD;AAC7D,UAAI7K,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkBnE,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAIoE,aAAa,KAAKuJ,KAAL,CAAWzN,OAAOC,QAAlB,GAAjB,EAAgDkE,MAArD,EAA6D,EAAEJ,6BAA6B,CAACI,SAASD,WAAW/D,IAAX,EAAV,EAA6BC,IAA5D,CAA7D,EAAgI2D,6BAA6B,IAA7J,EAAmK;AACjK,cAAIgK,OAAO5J,OAAO5G,KAAlB;;AAEAuQ,YAAEU,MAAF,CAAST,KAAKgC,IAAd,EAAoB,EAAEvQ,MAAMmP,OAAR,EAApB;AACAZ,eAAKgC,IAAL,CAAUlP,IAAV,CAAe,IAAf;AACD;AACF,OAPD,CAOE,OAAOP,GAAP,EAAY;AACZ0D,6BAAqB,IAArB;AACAC,0BAAkB3D,GAAlB;AACD,OAVD,SAUU;AACR,YAAI;AACF,cAAI,CAACyD,0BAAD,IAA+BG,WAAWqM,MAA9C,EAAsD;AACpDrM,uBAAWqM,MAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIvM,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA5BA,GApEiB,EAiGjB;AACD5H,SAAK,kBADJ;AAEDkB,WAAO,SAAS8T,gBAAT,GAA4B;AACjC,UAAI9L,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkB3F,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAI4F,aAAa,KAAK+H,KAAL,CAAWzN,OAAOC,QAAlB,GAAjB,EAAgD0F,MAArD,EAA6D,EAAEJ,6BAA6B,CAACI,SAASD,WAAWvF,IAAX,EAAV,EAA6BC,IAA5D,CAA7D,EAAgImF,6BAA6B,IAA7J,EAAmK;AACjK,cAAIwI,OAAOpI,OAAOpI,KAAlB;;AAEAwQ,eAAKyC,mBAAL,CAAyB,IAAzB;AACD;AACF,OAND,CAME,OAAOlQ,GAAP,EAAY;AACZkF,6BAAqB,IAArB;AACAC,0BAAkBnF,GAAlB;AACD,OATD,SASU;AACR,YAAI;AACF,cAAI,CAACiF,0BAAD,IAA+BG,WAAW6K,MAA9C,EAAsD;AACpD7K,uBAAW6K,MAAX;AACD;AACF,SAJD,SAIU;AACR,cAAI/K,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA3BA,GAjGiB,EA6HjB;AACDpJ,SAAK,YADJ;AAEDkB,WAAO,SAAS+T,UAAT,GAAsB;AAC3B,aAAO,KAAKrO,YAAL,IAAqB,aAA5B;AACD;AAJA,GA7HiB,EAkIjB;AACD5G,SAAK,aADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,KAAP;AACD;AAJA,GAlIiB,CAApB,EAuII,CAAC;AACHxN,SAAK,sBADF;AAEHkB,WAAO,SAASsT,oBAAT,CAA8Bd,IAA9B,EAAoC;AACzC,aAAOA,KAAK5K,IAAL,CAAU,UAAUwK,CAAV,EAAa4B,CAAb,EAAgB;AAC/B,eAAO5B,EAAEK,KAAF,GAAUuB,EAAEvB,KAAnB;AACD,OAFM,EAEJlN,GAFI,CAEA,UAAUuN,GAAV,EAAexU,CAAf,EAAkB;AACvB,eAAO,MAAMwU,IAAIL,KAAjB;AACD,OAJM,EAIJwB,IAJI,CAIC,GAJD,CAAP;AAKD;AARE,GAAD,CAvIJ;;AAkJA,SAAOnI,KAAP;AACD,CArK2B,CAqK1BkB,gBAAgBgD,MArKU,CAA5B;;AAuKA;AACA,IAAInE,qBAAqBL,QAAQK,kBAAR,GAA6B,UAAUqI,QAAV,EAAoB;AACxE7G,YAAUxB,kBAAV,EAA8BqI,QAA9B;;AAEA,WAASrI,kBAAT,GAA8B;AAC5B9N,oBAAgB,IAAhB,EAAsB8N,kBAAtB;;AAEA,WAAOqB,2BAA2B,IAA3B,EAAiC,CAACrB,mBAAmB8B,SAAnB,IAAgC/O,OAAOiO,cAAP,CAAsBhB,kBAAtB,CAAjC,EAA4EsI,KAA5E,CAAkF,IAAlF,EAAwFlO,SAAxF,CAAjC,CAAP;AACD;;AAEDlH,eAAa8M,kBAAb,EAAiC,CAAC;AAChC/M,SAAK,6BAD2B;AAEhCkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKR,mBAAmB3M,SAAnB,CAA6ByO,SAA7B,IAA0C/O,OAAOiO,cAAP,CAAsBhB,mBAAmB3M,SAAzC,CAA/C,EAAoG,6BAApG,EAAmI,IAAnI,EAAyI6N,IAAzI,CAA8I,IAA9I,EAAoJtF,OAApJ;AACA,WAAK2M,OAAL,GAAe3M,QAAQ2M,OAAvB;AACD;AAL+B,GAAD,EAM9B;AACDtV,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,qBAAP;AACD;AAJA,GAN8B,CAAjC;;AAaA,SAAOT,kBAAP;AACD,CAvBqD,CAuBpDmB,gBAAgBgD,MAvBoC,CAAtD;;AAyBA;AACA,IAAIpE,QAAQJ,QAAQI,KAAR,GAAgB,UAAUyI,QAAV,EAAoB;AAC9ChH,YAAUzB,KAAV,EAAiByI,QAAjB;;AAEA,WAASzI,KAAT,CAAeiC,QAAf,EAAyB;AACvB9P,oBAAgB,IAAhB,EAAsB6N,KAAtB;;AAEA,WAAOsB,2BAA2B,IAA3B,EAAiC,CAACtB,MAAM+B,SAAN,IAAmB/O,OAAOiO,cAAP,CAAsBjB,KAAtB,CAApB,EAAkDmB,IAAlD,CAAuD,IAAvD,EAA6Dc,QAA7D,CAAjC,CAAP;AACD;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA9O,eAAa6M,KAAb,EAAoB,CAAC;AACnB9M,SAAK,cADc;AAEnBkB,WAAO,SAASsU,YAAT,GAAwB;AAC7B,aAAO,IAAP;AACD;AAJkB,GAAD,EAKjB;AACDxV,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,QAAP;AACD;AAJA,GALiB,CAApB;;AAYA,SAAOV,KAAP;AACD,CA/B2B,CA+B1BoB,gBAAgBgD,MA/BU,CAA5B;;AAiCA;AACA,IAAIrE,oBAAoBH,QAAQG,iBAAR,GAA4B,UAAU4I,QAAV,EAAoB;AACtElH,YAAU1B,iBAAV,EAA6B4I,QAA7B;;AAEA,WAAS5I,iBAAT,GAA6B;AAC3B5N,oBAAgB,IAAhB,EAAsB4N,iBAAtB;;AAEA,WAAOuB,2BAA2B,IAA3B,EAAiC,CAACvB,kBAAkBgC,SAAlB,IAA+B/O,OAAOiO,cAAP,CAAsBlB,iBAAtB,CAAhC,EAA0EwI,KAA1E,CAAgF,IAAhF,EAAsFlO,SAAtF,CAAjC,CAAP;AACD;;AAEDlH,eAAa4M,iBAAb,EAAgC,CAAC;AAC/B7M,SAAK,6BAD0B;AAE/BkB,WAAO,SAASgO,2BAAT,CAAqCvG,OAArC,EAA8C;AACnD4E,WAAKV,kBAAkBzM,SAAlB,CAA4ByO,SAA5B,IAAyC/O,OAAOiO,cAAP,CAAsBlB,kBAAkBzM,SAAxC,CAA9C,EAAkG,6BAAlG,EAAiI,IAAjI,EAAuI6N,IAAvI,CAA4I,IAA5I,EAAkJtF,OAAlJ;AACA,WAAKuB,GAAL,GAAWvB,QAAQuB,GAAnB;AACD;AAL8B,GAAD,EAM7B;AACDlK,SAAK,cADJ;AAEDkB,WAAO,SAASsU,YAAT,GAAwB;AAC7B,aAAO,IAAP;AACD;AAJA,GAN6B,EAW7B;AACDxV,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,cAAP;AACD;AAJA,GAX6B,CAAhC;;AAkBA,SAAOX,iBAAP;AACD,CA5BmD,CA4BlDqB,gBAAgBgD,MA5BkC,CAApD;;AA8BA;AACA,IAAItE,aAAaF,QAAQE,UAAR,GAAqB,UAAU8I,MAAV,EAAkB;AACtDnH,YAAU3B,UAAV,EAAsB8I,MAAtB;;AAEA,WAAS9I,UAAT,CAAoB+I,OAApB,EAA6B;AAC3B1W,oBAAgB,IAAhB,EAAsB2N,UAAtB;;AAEA,QAAIgJ,UAAUxH,2BAA2B,IAA3B,EAAiC,CAACxB,WAAWiC,SAAX,IAAwB/O,OAAOiO,cAAP,CAAsBnB,UAAtB,CAAzB,EAA4DqB,IAA5D,CAAiE,IAAjE,EAAuE0H,OAAvE,CAAjC,CAAd;;AAEAC,YAAQhP,YAAR,GAAuB,aAAvB;AACA,WAAOgP,OAAP;AACD;;AAED3V,eAAa2M,UAAb,EAAyB,IAAzB,EAA+B,CAAC;AAC9B5M,SAAK,iBADyB;AAE9BkB,WAAO,SAAS2U,eAAT,GAA2B;AAChC,aAAO,CAAC,IAAIjJ,UAAJ,CAAe;AACrBzJ,cAAMyJ,WAAWkJ,wBADI;AAErBnN,iBAAS;AACPgL,iBAAO,WADA;AAEPoC,uBAAa,IAFN;AAGPC,oBAAU,IAHH;AAIPC,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,cAAD,EAAiB,GAAjB,EAAsB,MAAtB,CAA1B;AAJJ;AAFY,OAAf,CAAD,EAQH,IAAIvJ,UAAJ,CAAe;AACjBzJ,cAAMyJ,WAAWwJ,6BADA;AAEjBzN,iBAAS;AACPgL,iBAAO,UADA;AAEPoC,uBAAa,IAFN;AAGPM,wBAAc,IAHP;AAIPJ,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,UAAD,EAAa,GAAb,EAAkB,IAAlB,CAA1B;AAJJ;AAFQ,OAAf,CARG,EAgBH,IAAIvJ,UAAJ,CAAe;AACjBzJ,cAAMyJ,WAAW0J,4BADA;AAEjB3N,iBAAS;AACPgL,iBAAO,OADA;AAEPoC,uBAAa,IAFN;AAGPQ,sBAAY,IAHL;AAIPN,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,iBAAD,EAAoB,GAApB,EAAyB,IAAzB,CAA1B;AAJJ;AAFQ,OAAf,CAhBG,CAAP;AAyBD;AA5B6B,GAAD,CAA/B;;AA+BA,SAAOvJ,UAAP;AACD,CA5CqC,CA4CpCI,KA5CoC,CAAtC;;AA8CAJ,WAAWkJ,wBAAX,GAAsC,WAAtC;AACAlJ,WAAWwJ,6BAAX,GAA2C,gBAA3C;AACAxJ,WAAW0J,4BAAX,GAA0C,eAA1C;AACA;AACA,IAAI3J,UAAUD,QAAQC,OAAR,GAAkB,UAAU6J,YAAV,EAAwB;AACtDjI,YAAU5B,OAAV,EAAmB6J,YAAnB;;AAEA,WAAS7J,OAAT,CAAiBoC,QAAjB,EAA2B;AACzB9P,oBAAgB,IAAhB,EAAsB0N,OAAtB;;AAEA,QAAI8J,UAAUrI,2BAA2B,IAA3B,EAAiC,CAACzB,QAAQkC,SAAR,IAAqB/O,OAAOiO,cAAP,CAAsBpB,OAAtB,CAAtB,EAAsDsB,IAAtD,CAA2D,IAA3D,EAAiEc,QAAjE,CAAjC,CAAd;;AAEA0H,YAAQ9G,IAAR,GAAe,QAAf;AACA,WAAO8G,OAAP;AACD;;AAEDxW,eAAa0M,OAAb,EAAsB,CAAC;AACrB3M,SAAK,aADgB;AAErBkB,WAAO,SAASwV,WAAT,GAAuB;AAC5B,aAAO,KAAKhH,YAAL,IAAqB,KAAKA,YAAL,CAAkBiH,SAA9C;AACD;AAJoB,GAAD,EAKnB;AACD3W,SAAK,gBADJ;AAEDkB,WAAO,SAAS0V,cAAT,CAAwBC,KAAxB,EAA+B;AACpC,WAAKvG,cAAL,CAAoB,aAApB,EAAmCuG,KAAnC;AACD;AAJA,GALmB,EAUnB;AACD7W,SAAK,gBADJ;AAEDkB,WAAO,SAAS4V,cAAT,GAA0B;AAC/B,aAAO,KAAK3G,cAAL,CAAoB,aAApB,KAAsC,EAAE4G,WAAW,EAAb,EAAiBF,OAAO,EAAxB,EAA7C;AACD;;AAED;;AANC,GAVmB,EAkBnB;AACD7W,SAAK,gBADJ;AAEDkB,WAAO,SAAS8V,cAAT,GAA0B;AAC/B,aAAO,KAAK7G,cAAL,CAAoB,aAApB,CAAP;AACD;AAJA,GAlBmB,EAuBnB;AACDnQ,SAAK,qBADJ;AAEDkB,WAAO,SAAS+V,mBAAT,CAA6BC,EAA7B,EAAiC;AACtC,WAAK5G,cAAL,CAAoB,sBAApB,EAA4C4G,EAA5C;AACD;AAJA,GAvBmB,EA4BnB;AACDlX,SAAK,qBADJ;AAEDkB,WAAO,SAASiW,mBAAT,GAA+B;AACpC,aAAO,KAAKhH,cAAL,CAAoB,sBAApB,CAAP;AACD;;AAED;;AANC,GA5BmB,EAoCnB;AACDnQ,SAAK,iBADJ;AAEDkB,WAAO,SAASkW,eAAT,CAAyBxH,MAAzB,EAAiC;AACtC,WAAKU,cAAL,CAAoB,cAApB,EAAoCV,MAApC;AACD;AAJA,GApCmB,EAyCnB;AACD5P,SAAK,gBADJ;AAEDkB,WAAO,SAASmW,cAAT,GAA0B;AAC/B,aAAO,KAAKlH,cAAL,CAAoB,cAApB,CAAP;AACD;AAJA,GAzCmB,EA8CnB;AACDnQ,SAAK,cADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,UAAP;AACD;AAJA,GA9CmB,EAmDnB;AACDxN,SAAK,aADJ;AAEDwN,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,OAAP;AACD;AAJA,GAnDmB,CAAtB;;AA0DA,SAAOb,OAAP;AACD,CAvE+B,CAuE9BU,WAvE8B,CAAhC;;AAyEA;;AAEA,IAAI,OAAOlL,MAAP,KAAkB,WAAlB,IAAiCA,WAAW,IAAhD,EAAsD;AACpD;AACA,MAAI;AACFA,WAAO8K,MAAP,GAAgBA,MAAhB;AACA9K,WAAO6K,KAAP,GAAeA,KAAf;AACA7K,WAAOyK,UAAP,GAAoBA,UAApB;AACAzK,WAAO2K,KAAP,GAAeA,KAAf;AACA3K,WAAO0K,iBAAP,GAA2BA,iBAA3B;AACA1K,WAAOkL,WAAP,GAAqBA,WAArB;AACAlL,WAAOiL,QAAP,GAAkBA,QAAlB;AACAjL,WAAO+K,WAAP,GAAqBA,WAArB;AACA/K,WAAOwK,OAAP,GAAiBA,OAAjB;AACAxK,WAAO4K,kBAAP,GAA4BA,kBAA5B;AACD,GAXD,CAWE,OAAOuK,CAAP,EAAU;AACVhW,YAAQC,GAAR,CAAY,sDAAZ,EAAoE+V,CAApE;AACD;AACF;AACD;AACA,CAAC;;AAEDC,QAAQ9K,MAAR,CAAe,KAAf,EAAsB,EAAtB;IAGO+K,Q,GACL,kBAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;AAAA;;AAExC,MAAIC,sBAAsB,aAA1B;;AAEA,MAAIC,mBAAmB,IAAI1V,OAAO9B,gBAAX,CAA4B,EAA5B,EAAgC,YAAM;AAC3D;AACAoX,eAAWvU,QAAX,GAAsB2U,iBAAiB3U,QAAvC;AACD,GAHsB,CAAvB;;AAKA,MAAI4U,YAAY,GAAhB;;AAEAJ,SAAOK,cAAP,GAAwB,UAASC,SAAT,EAAoB;AAC1C,QAAIC,WAAW,SAAXA,QAAW,CAACvE,IAAD,EAAU;AACvB,aAAOA,KAAK5K,IAAL,CAAU,UAACwK,CAAD,EAAI4B,CAAJ,EAAU;AACzB,YAAMgD,SAAS5E,EAAE3K,OAAF,CAAUgL,KAAV,CAAgBwE,WAAhB,EAAf;AAAA,YAA8CC,SAASlD,EAAEvM,OAAF,CAAUgL,KAAV,CAAgBwE,WAAhB,EAAvD;AACA,eAAO,CAACD,SAASE,MAAV,KAAqBF,SAASE,MAA9B,CAAP;AACD,OAHM,CAAP;AAID,KALD;AAMA,QAAIC,WAAWL,UAAUM,OAAV,CAAkBrN,KAAlB,EAAf;;AAEA,QAAIsN,kBAAkB,SAAlBA,eAAkB,CAAS5E,KAAT,EAAgB;AAAA;AAAA;AAAA;;AAAA;AACpC,8BAAeqE,UAAUM,OAAzB,mIAAkC;AAAA,cAA1BtE,GAA0B;;AAChC,cAAGA,IAAIrL,OAAJ,CAAYgL,KAAZ,KAAsBA,KAAzB,EAAgC;AAC9B,mBAAOK,GAAP;AACD;AACF;AALmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMpC,aAAO,IAAP;AACD,KAPD;;AAT0C;AAAA;AAAA;;AAAA;AAkB1C,4BAAegE,UAAUM,OAAzB,mIAAkC;AAAA,YAA1BtE,GAA0B;;AAChC,YAAIwE,eAAexE,IAAIxL,QAAJ,IAAgBwL,IAAIxL,QAAJ,CAAa0C,IAAb,CAAkB,UAACY,CAAD,EAAO;AAAC,iBAAOA,EAAE6I,KAAT;AAAe,SAAzC,CAAnC;AACAX,YAAIxL,QAAJ,GAAe,EAAf;AACAwL,YAAInP,MAAJ,GAAa,IAAb;;AAEA,YAAG2T,YAAH,EAAiB;AACfxE,cAAIxL,QAAJ,CAAaiQ,OAAb,CAAqBD,YAArB;AACD;AACF;AA1ByC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA0BzC;;AA1ByC;AAAA;AAAA;;AAAA;AA4B1C,4BAAeR,UAAUM,OAAzB,mIAAkC;AAAA,YAA1BtE,GAA0B;;AAChC,YAAIxE,OAAOwE,IAAIrL,OAAJ,CAAYgL,KAAvB;AACA,YAAI+E,QAAQlJ,KAAKmJ,KAAL,CAAWb,SAAX,CAAZ;AACA9D,YAAI4E,YAAJ,GAAmBF,MAAMA,MAAMjZ,MAAN,GAAc,CAApB,CAAnB;AACA,YAAGiZ,MAAMjZ,MAAN,IAAgB,CAAnB,EAAsB;AACpBuU,cAAInP,MAAJ,GAAamT,SAAb;AACA;AACD;;AAED,YAAIa,YAAY,SAAZA,SAAY,GAAoB;AAAA,cAAXC,KAAW,uEAAH,CAAG;;AAClC,cAAIC,cAAcL,MAAMzN,KAAN,CAAY,CAAZ,EAAeyN,MAAMjZ,MAAN,GAAeqZ,KAA9B,EAAqC3D,IAArC,CAA0C2C,SAA1C,CAAlB;AACA,cAAGiB,YAAYtZ,MAAZ,IAAsB,CAAzB,EAA4B;AAC1B,mBAAO,IAAP;AACD;AACD,cAAIoF,SAAS0T,gBAAgBQ,WAAhB,CAAb;;AAEA;AACA;AACA,cAAG,CAAClU,MAAD,IAAWiU,QAAQJ,MAAMjZ,MAAN,GAAe,CAArC,EAAwC;AACtC,mBAAOoZ,UAAUC,QAAQ,CAAlB,CAAP;AACD;;AAED;AACA,cAAIE,WAAWhF,IAAIrL,OAAJ,CAAYgL,KAAZ,CAAkB1I,KAAlB,CAAwB8N,YAAYtZ,MAAZ,GAAmB,CAA3C,CAAf;AACAuU,cAAI4E,YAAJ,GAAmBI,QAAnB;;AAEA,iBAAOnU,MAAP;AACD,SAlBD;;AAoBA,YAAIA,SAASgU,WAAb;;AAEA;AACA,YAAG,CAAChU,MAAJ,EAAY;AACVmP,cAAI4E,YAAJ,GAAmB5E,IAAIrL,OAAJ,CAAYgL,KAA/B;AACAK,cAAInP,MAAJ,GAAamT,SAAb;AACA;AACD;;AAEDnT,eAAO2D,QAAP,CAAgBhE,IAAhB,CAAqBwP,GAArB;AACAnP,eAAO2D,QAAP,GAAkByP,SAASpT,OAAO2D,QAAhB,CAAlB;AACAwL,YAAInP,MAAJ,GAAaA,MAAb;;AAEA;AACA,YAAIoU,QAAQZ,SAASrH,OAAT,CAAiBgD,GAAjB,CAAZ;AACAqE,iBAASa,MAAT,CAAgBD,KAAhB,EAAuB,CAAvB;;AAEA,YAAGvB,OAAOyB,WAAP,IAAsBzB,OAAOyB,WAAP,CAAmBhW,IAAnB,IAA2B6Q,IAAI7Q,IAAxD,EAA8D;AAC5DuU,iBAAOyB,WAAP,GAAqBnF,GAArB;AACA0D,iBAAO0B,iBAAP,CAAyBpF,GAAzB,EAA8B,IAA9B;AACD;AACF;AA9EyC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgF1C,QAAIwE,eAAeR,UAAUxP,QAAV,IAAsBwP,UAAUxP,QAAV,CAAmB0C,IAAnB,CAAwB,UAACY,CAAD,EAAO;AAAC,aAAOA,EAAE6I,KAAT;AAAe,KAA/C,CAAzC;AACAqD,cAAUxP,QAAV,GAAqByP,SAASI,QAAT,CAArB;AACA,QAAGG,YAAH,EAAiB;AAAER,gBAAUxP,QAAV,CAAmBiQ,OAAnB,CAA2BD,YAA3B;AAA2C;AAC/D,GAnFD;;AAqFAd,SAAO2B,YAAP,GAAsB,UAASC,QAAT,EAAmBC,QAAnB,EAA6B;AACjD,QAAIC,SAAS9B,OAAOM,SAAP,CAAiBM,OAAjB,CAAyB1V,MAAzB,CAAgC,UAASoR,GAAT,EAAa;AACxD,aAAOA,IAAI7Q,IAAJ,KAAamW,QAApB;AACD,KAFY,EAEV,CAFU,CAAb;;AAIA,QAAIha,SAASia,aAAa,GAAb,GAAmB7B,OAAOM,SAA1B,GAAsCN,OAAOM,SAAP,CAAiBM,OAAjB,CAAyB1V,MAAzB,CAAgC,UAASoR,GAAT,EAAa;AAC9F,aAAOA,IAAI7Q,IAAJ,KAAaoW,QAApB;AACD,KAFkD,EAEhD,CAFgD,CAAnD;;AAIA,QAAGja,OAAOuF,MAAP,KAAkB2U,MAArB,EAA6B;AAC3B;AACD;;AAED,QAAIC,YAAY,CAACD,MAAD,CAAhB;;AAEA,QAAIE,iBAAiB,SAAjBA,cAAiB,CAASF,MAAT,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACpC,8BAAiBA,OAAOhR,QAAxB,mIAAkC;AAAA,cAA1BmR,KAA0B;;AAChC,cAAIC,WAAWJ,OAAO7Q,OAAP,CAAegL,KAAf,GAAuBmE,SAAvB,GAAmC6B,MAAMhR,OAAN,CAAcgL,KAAd,CAAoBgF,KAApB,CAA0Bb,SAA1B,EAAqC7M,KAArC,CAA2C,CAAC,CAA5C,EAA+C,CAA/C,CAAlD;AACA0O,gBAAMhR,OAAN,CAAcgL,KAAd,GAAsBiG,QAAtB;AACAH,oBAAUjV,IAAV,CAAemV,KAAf;AACAD,yBAAeC,KAAf;AACD;AANmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOrC,KAPD;;AASA,QAAIC,QAAJ;AACA,QAAGta,OAAOua,MAAV,EAAkB;AAChBD,iBAAWJ,OAAO7Q,OAAP,CAAegL,KAAf,CAAqBgF,KAArB,CAA2Bb,SAA3B,EAAsC7M,KAAtC,CAA4C,CAAC,CAA7C,EAAgD,CAAhD,CAAX;AACD,KAFD,MAEO;AACL2O,iBAAWta,OAAOqJ,OAAP,CAAegL,KAAf,GAAuBmE,SAAvB,GAAmC0B,OAAO7Q,OAAP,CAAegL,KAAf,CAAqBgF,KAArB,CAA2Bb,SAA3B,EAAsC7M,KAAtC,CAA4C,CAAC,CAA7C,EAAgD,CAAhD,CAA9C;AACD;AACDuO,WAAO7Q,OAAP,CAAegL,KAAf,GAAuBiG,QAAvB;AACAF,mBAAeF,MAAf;AACA9B,WAAOK,cAAP,CAAsBL,OAAOM,SAA7B;;AAEAH,qBAAiBzQ,SAAjB,CAA2BqS,SAA3B;AACD,GAnCD;;AAqCA/B,SAAOoC,SAAP,GAAmB,UAAS9F,GAAT,EAAc;AAC/B,QAAIL,QAAQK,IAAIrL,OAAJ,CAAYgL,KAAxB;AACA,QAAGA,MAAMoG,UAAN,CAAiB,IAAjB,CAAH,EAA2B;AACzB;;;;;;AAMA,UAAI;AACF,YAAIC,aAAajY,KAAKC,KAAL,CAAW2R,MAAMsG,SAAN,CAAgB,CAAhB,EAAmBtG,MAAMlU,MAAzB,CAAX,CAAjB;AACD,OAFD,CAEE,OAAO6X,CAAP,EAAU;AACVvU,cAAM,oIAAN;AACA;AACD;AACD,UAAImX,WAAW;AACbtT,sBAAcgR,mBADD;AAEbjP,iBAAS;AACPgL,iBAAOqG,WAAW,CAAX,CADA;AAEP/D,qBAAW;AACTkE,qBAASH,WAAW,CAAX,CADA;AAETI,sBAAUJ,WAAW,CAAX,CAFD;AAGT9Y,mBAAO8Y,WAAW,CAAX;AAHE;AAFJ;AAFI,OAAf;AAWAnC,uBAAiBzR,UAAjB,CAA4B8T,QAA5B,EAAsC,UAACG,UAAD,EAAgB;AACpD;AACA;AACA;AACA3C,eAAO4C,YAAP,GAAsBD,UAAtB;AACD,OALD;AAMD,KA9BD,MA8BO;AACLrG,UAAIpN,YAAJ,GAAmB,KAAnB;AACA,UAAI+M,KAAJ;AACA,UAAGK,IAAInP,MAAJ,CAAWgV,MAAd,EAAsB;AACpBlG,gBAAQK,IAAIrL,OAAJ,CAAYgL,KAApB;AACD,OAFD,MAEO;AACLA,gBAAQK,IAAInP,MAAJ,CAAW8D,OAAX,CAAmBgL,KAAnB,GAA2BmE,SAA3B,GAAuC9D,IAAIrL,OAAJ,CAAYgL,KAA3D;AACD;AACDK,UAAIrL,OAAJ,CAAYgL,KAAZ,GAAoBA,KAApB;AACAK,UAAIW,KAAJ,GAAY,KAAZ;AACAkD,uBAAiBzR,UAAjB,CAA4B4N,GAA5B,EAAiC,UAACqG,UAAD,EAAgB;AAC/C3C,eAAO4C,YAAP,GAAsBD,UAAtB;AACD,OAFD;AAGD;AACF,GA9CD;;AAgDA3C,SAAO6C,SAAP,GAAmB,UAASvG,GAAT,EAAcwG,WAAd,EAA2B;AAC5C,QAAIvF,aAAajB,IAAIpN,YAAJ,IAAoBgR,mBAArC;AACA;AACA,QAAG3C,UAAH,EAAe;AACbuF,oBAAc,KAAd;AACD;;AAED,QAAIC,6BAA6B,SAA7BA,0BAA6B,GAAW;AAC1C,UAAG/C,OAAOgD,YAAV,EAAwB;AAAA;AAAA;AAAA;;AAAA;AACtB,gCAAuBhD,OAAOgD,YAA9B,mIAA4C;AAAA,gBAApCvB,WAAoC;;AAC1CzB,mBAAO0B,iBAAP,CAAyBD,WAAzB,EAAsC,KAAtC;AACD;AAHqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIvB;AACF,KAND;;AAQA,QAAGnF,IAAI6F,MAAJ,IAAc7F,IAAI2G,WAArB,EAAkC;AAChCF;AACA/C,aAAOgD,YAAP,GAAsB,EAAtB;AACA7C,uBAAiBlR,cAAjB;AACD,KAJD,MAIO;AACL,UAAG,CAAC+Q,OAAOgD,YAAX,EAAyB;AAAEhD,eAAOgD,YAAP,GAAsB,EAAtB;AAA2B;AACtD,UAAG,CAACzF,UAAJ,EAAgB;AACdyC,eAAOgD,YAAP,CAAoBlW,IAApB,CAAyBwP,GAAzB;AACD;AACD,UAAGwG,eAAe9C,OAAOgD,YAAP,CAAoBjb,MAApB,GAA6B,CAA/C,EAAkD;AAChD,YAAIya,WAAWxC,OAAOkD,mCAAP,EAAf;AACA/C,yBAAiB3R,UAAjB,CAA4BgU,QAA5B;AACD,OAHD,MAGO;AACLO;AACA/C,eAAOgD,YAAP,GAAsBzF,aAAa,EAAb,GAAkB,CAACjB,GAAD,CAAxC;AACA6D,yBAAiB3R,UAAjB,CAA4B8N,GAA5B;AACD;AACF;;AAED;AACA;AACA;;AAEA,QAAG,CAACwG,WAAD,IAAgB9C,OAAOyB,WAAvB,IAAsCzB,OAAOyB,WAAP,IAAsBnF,GAA/D,EAAoE;AAClE0D,aAAO0B,iBAAP,CAAyB1B,OAAOyB,WAAhC,EAA6C,KAA7C;AACAzB,aAAOyB,WAAP,CAAmB0B,OAAnB,GAA6B,KAA7B;AACD,KAHD,MAGO,IAAGnD,OAAOyB,WAAP,CAAmBU,MAAnB,IAA6BnC,OAAOyB,WAAP,CAAmBwB,WAAhD,IAA+DjD,OAAOyB,WAAP,CAAmBvS,YAAnB,IAAmCgR,mBAArG,EAA0H;AAC/HF,aAAO0B,iBAAP,CAAyB1B,OAAOyB,WAAhC,EAA6C,KAA7C;AACD;;AAED,QAAGzB,OAAOyB,WAAP,KAAuBnF,GAAvB,IAA8B,CAACA,IAAI6F,MAAnC,IAA6C,CAAC7F,IAAIrL,OAAJ,CAAYoN,WAA7D,EAA0E;AACxE/B,UAAI6G,OAAJ,GAAc,IAAd;AACD;;AAEDnD,WAAOyB,WAAP,GAAqBnF,GAArB;AACA0D,WAAO0B,iBAAP,CAAyBpF,GAAzB,EAA8B,IAA9B;AACD,GAnDD;;AAqDA0D,SAAOkD,mCAAP,GAA6C,YAAW;AACtD,QAAIV,WAAW;AACb/W,YAAMmJ,KAAKC,MAAL,EADO;AAEb3F,oBAAc,aAFD;AAGb+B,eAAS;AACPgL,eAAO;AADA;AAHI,KAAf;;AAQA,QAAImH,WAAWpD,OAAOgD,YAAP,CAAoBjU,GAApB,CAAwB,UAACuN,GAAD,EAAS;AAAC,aAAOA,IAAIrL,OAAJ,CAAYgL,KAAnB;AAAyB,KAA3D,CAAf;AACA,QAAIsC,YAAY,CAAC,MAAD,EAAS,UAAT,EAAqB,CAAC,OAAD,EAAU,IAAV,EAAgB6E,QAAhB,CAArB,CAAhB;AACAZ,aAASvR,OAAT,CAAiBsN,SAAjB,GAA6BA,SAA7B;AACA,WAAOiE,QAAP;AACD,GAbD;;AAeAxC,SAAOqD,cAAP,GAAwB,UAAS/G,GAAT,EAAc;AACpCA,QAAIgH,UAAJ,CAAeC,SAAf,GAA2B,CAACjH,IAAIgH,UAAJ,CAAeC,SAA3C;AACA,QAAG,CAACjH,IAAI6F,MAAR,EAAgB;AACdhC,uBAAiB5Q,QAAjB,CAA0B+M,GAA1B;AACD;AACF,GALD;;AAOA0D,SAAOwD,QAAP,GAAkB,UAASxH,IAAT,EAAe;AAC/BmE,qBAAiBzQ,SAAjB,CAA2BsM,IAA3B;AACD,GAFD;;AAIAgE,SAAO0B,iBAAP,GAA2B,UAASpF,GAAT,EAAcmH,QAAd,EAAwB;AACjDnH,QAAImH,QAAJ,GAAeA,QAAf;AACD,GAFD;;AAIAtD,mBAAiB1S,WAAjB,CAA6B,CAAC,KAAD,EAAQyS,mBAAR,CAA7B,EAA2D,UAACwD,OAAD,EAAa;AACtEzD,aAAS,YAAM;AACb,UAAI0D,UAAU3D,OAAOM,SAAP,GAAmBN,OAAOM,SAAP,CAAiBM,OAApC,GAA8C,EAA5D;AACA,UAAIgD,YAAY5D,OAAO6D,cAAP,GAAwB7D,OAAO6D,cAAP,CAAsBjD,OAA9C,GAAwD1L,WAAWiJ,eAAX,EAAxE;AAFa;AAAA;AAAA;;AAAA;AAGb,+BAAeuF,OAAf,wIAAwB;AAAA,cAAhBpH,GAAgB;;AACtB,cAAIiB,aAAajB,IAAIpN,YAAJ,IAAoBgR,mBAArC;AACA,cAAI4D,aAAavG,aAAaqG,SAAb,GAAyBD,OAA1C;;AAEA,cAAII,WAAWD,WAAW5Y,MAAX,CAAkB,UAAC8Y,YAAD,EAAkB;AACjD,mBAAOA,aAAavY,IAAb,KAAsB6Q,IAAI7Q,IAAjC;AACD,WAFc,EAEZ,CAFY,CAAf;;AAIA,cAAGsY,QAAH,EAAa;AACX3b,mBAAOyI,MAAP,CAAckT,QAAd,EAAwBzH,GAAxB;AACD,WAFD,MAEO,IAAGA,IAAIrL,OAAJ,CAAYgL,KAAf,EAAsB;AAC3B6H,uBAAWhX,IAAX,CAAgBwP,GAAhB;AACD;;AAED,cAAGA,IAAI2H,OAAP,EAAgB;AACd,gBAAI1C,QAAQuC,WAAWxK,OAAX,CAAmByK,YAAYzH,GAA/B,CAAZ;AACAwH,uBAAWtC,MAAX,CAAkBD,KAAlB,EAAyB,CAAzB;AACD,WAHD,MAGO;AACL,gBAAGvB,OAAO4C,YAAP,IAAuB5C,OAAO4C,YAAP,CAAoBnX,IAApB,IAA4B6Q,IAAI7Q,IAA1D,EAAiE;AAC/DuU,qBAAO4C,YAAP,GAAsB,IAAtB;AACA5C,qBAAO6C,SAAP,CAAiBvG,GAAjB;AACD,aAHD,MAGO,IAAGyH,YAAY/D,OAAOyB,WAAnB,IAAkCzB,OAAOyB,WAAP,CAAmBhW,IAAnB,IAA2BsY,SAAStY,IAAzE,EAA+E;AACpF;AACAuU,qBAAO0B,iBAAP,CAAyBqC,QAAzB,EAAmC,IAAnC;AACD;AACF;AACF;AA7BY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA+Bb,UAAG,CAAC/D,OAAOM,SAAX,EAAsB;AACpBN,eAAOM,SAAP,GAAmB;AACjB6B,kBAAQ,IADS;AAEjBlR,mBAAS;AACPgL,mBAAO;AADA,WAFQ;AAKjBiF,wBAAc,KALG;AAMjBzV,gBAAM,GANW;AAOjB6X,sBAAY;AAPK,SAAnB;AASD;;AAED,UAAG,CAACtD,OAAO6D,cAAX,EAA2B;AACzB7D,eAAO6D,cAAP,GAAwB;AACtB1B,kBAAQ,IADc;AAEtBc,uBAAa,IAFS;AAGtBhS,mBAAS;AACPgL,mBAAO;AADA,WAHa;AAMtBiF,wBAAc,OANQ;AAOtBzV,gBAAM,GAPgB;AAQtB6X,sBAAY;AARU,SAAxB;AAUD;;AAEDtD,aAAOM,SAAP,CAAiBM,OAAjB,GAA2B+C,OAA3B;AACA3D,aAAO6D,cAAP,CAAsBjD,OAAtB,GAAgCgD,SAAhC;;AAEA,UAAG,CAAC5D,OAAOyB,WAAR,IAAwBzB,OAAOyB,WAAP,IAAsBzB,OAAOyB,WAAP,CAAmBU,MAApE,EAA6E;AAC3E,YAAGnC,OAAOyB,WAAP,IAAsBzB,OAAOyB,WAAP,CAAmBwB,WAA5C,EAAyD;AACvDjD,iBAAOyB,WAAP,GAAqBzB,OAAO6D,cAA5B;AACA7D,iBAAO0B,iBAAP,CAAyB1B,OAAOM,SAAhC,EAA2C,KAA3C;AACD,SAHD,MAGO;AACLN,iBAAOyB,WAAP,GAAqBzB,OAAOM,SAA5B;AACAN,iBAAO0B,iBAAP,CAAyB1B,OAAO6D,cAAhC,EAAgD,KAAhD;AACD;AACD7D,eAAO0B,iBAAP,CAAyB1B,OAAOyB,WAAhC,EAA6C,IAA7C;AACD;;AAED,UAAGzB,OAAOyB,WAAP,CAAmBwC,OAAtB,EAA+B;AAC7BjE,eAAO6C,SAAP,CAAiB7C,OAAOM,SAAxB;AACD;;AAEDN,aAAOK,cAAP,CAAsBL,OAAOM,SAA7B;AACAN,aAAOK,cAAP,CAAsBL,OAAO6D,cAA7B;AACD,KA5ED;AA6ED,GA9ED;;AAgFA7D,SAAOkE,SAAP,GAAmB,UAAS5H,GAAT,EAAc;AAC/B,QAAIiB,aAAajB,IAAIpN,YAAJ,IAAoBgR,mBAArC;AACA,QAAI4D,aAAavG,aAAayC,OAAO6D,cAAP,CAAsBjD,OAAnC,GAA6CZ,OAAOM,SAAP,CAAiBM,OAA/E;;AAEA,QAAItE,MAAMwH,WAAW5Y,MAAX,CAAkB,UAAS8Y,YAAT,EAAsB;AAChD,aAAOA,aAAavY,IAAb,KAAsB6Q,IAAI7Q,IAAjC;AACD,KAFS,EAEP,CAFO,CAAV;;AAIA,QAAI0Y,cAAc,EAAlB;;AAEA,aAASC,WAAT,CAAqB9H,GAArB,EAA0B;AACxB6H,kBAAYrX,IAAZ,CAAiBwP,GAAjB;AACA,UAAGA,IAAIxL,QAAP,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACf,iCAAiBwL,IAAIxL,QAArB,wIAA+B;AAAA,gBAAvBmR,KAAuB;;AAC7BmC,wBAAYnC,KAAZ;AACD;AAHc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIhB;AACF;;AAEDmC,gBAAY9H,GAAZ;;AAEA6D,qBAAiB/Q,WAAjB,CAA6B+U,WAA7B;AACD,GAtBD;AAuBD,C;;AAGH;;;AACArE,SAASuE,WAAT,GAAuB,IAAvB;;AAEAxE,QAAQ9K,MAAR,CAAe,KAAf,EAAsBuP,UAAtB,CAAiC,UAAjC,EAA6CxE,QAA7C;AACA,CAACD,QACE9K,MADF,CACS,KADT,EAEEwP,SAFF,CAEY,aAFZ,EAE2B,CAAC,UAAD,EAAa,UAAStE,QAAT,EAAmB;AACxD,SAAO;AACLuE,cAAU,GADL;AAELC,WAAO;AACLC,mBAAa;AADR,KAFF;AAKLjS,UAAO,cAASuN,MAAT,EAAiB2E,QAAjB,EAA2B;AAChC1E,eAAS,YAAW;AAClB,YAAGD,OAAO0E,WAAV,EAAuB;AACrBC,mBAAS,CAAT,EAAYC,KAAZ;AACD;AACF,OAJD;AAKD;AAXI,GAAP;AAaD,CAdyB,CAF3B;AAiBD,CAAC/E,QACE9K,MADF,CACS,KADT,EAEEwP,SAFF,CAEY,WAFZ,EAEyB,YAAW;AACnC,SAAQ;AACNE,WAAO;AACLI,aAAO,GADF;AAELC,YAAM,GAFD;AAGLC,mBAAa,GAHR;AAILC,mBAAa;AAJR,KADD;AAONvS,UAAM,cAASgS,KAAT,EAAgBhR,OAAhB,EAAyBwR,KAAzB,EAAgC;AACpC;AACA,UAAIC,KAAKzR,QAAQ,CAAR,CAAT;;AAEAyR,SAAGC,SAAH,GAAeV,MAAMM,WAArB;;AAEA,UAAIK,UAAU,CAAd;;AAEAF,SAAG1a,gBAAH,CACE,WADF,EAEE,UAASoV,CAAT,EAAY;AACVwF,kBAAU,CAAV;AACAxF,UAAEyF,YAAF,CAAeC,aAAf,GAA+B,MAA/B;AACA1F,UAAEyF,YAAF,CAAevK,OAAf,CAAuB,OAAvB,EAAgCzQ,KAAK6C,SAAL,CAAeuX,MAAMI,KAArB,CAAhC;AACA,aAAKU,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AACA,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAN,SAAG1a,gBAAH,CACE,SADF,EAEE,UAASoV,CAAT,EAAY;AACV,aAAK2F,SAAL,CAAe9K,MAAf,CAAsB,MAAtB;AACA,aAAK8K,SAAL,CAAe9K,MAAf,CAAsB,MAAtB;AACA,eAAO,KAAP;AACD,OANH,EAOE,KAPF;;AAUAyK,SAAG1a,gBAAH,CACE,UADF,EAEE,UAASoV,CAAT,EAAY;AACVA,UAAEyF,YAAF,CAAeI,UAAf,GAA4B,MAA5B;AACA;AACA,YAAI7F,EAAE8F,cAAN,EAAsB9F,EAAE8F,cAAF;AACtB,YAAGjB,MAAMO,WAAT,EAAsB;AAAE,eAAKO,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AAA6B;AACrD,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAN,SAAG1a,gBAAH,CACE,WADF,EAEE,UAASoV,CAAT,EAAY;AACVwF;AACA,YAAGX,MAAMO,WAAT,EAAsB;AAAE,eAAKO,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AAA6B;AACrD,eAAO,KAAP;AACD,OANH,EAOE,KAPF;;AAUAN,SAAG1a,gBAAH,CACE,WADF,EAEE,UAASoV,CAAT,EAAY;AACVwF;AACC,YAAIA,YAAY,CAAhB,EAAmB;AACjB,eAAKG,SAAL,CAAe9K,MAAf,CAAsB,MAAtB;AACD;AACF,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAyK,SAAG1a,gBAAH,CACE,UADF,EAEE,UAASoV,CAAT,EAAY;AACV;AACA;AACG,aAAK2F,SAAL,CAAe9K,MAAf,CAAsB,MAAtB;AACH;AACA,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAyK,SAAG1a,gBAAH,CACE,MADF,EAEE,UAASoV,CAAT,EAAY;;AAEV;AACAwF,kBAAU,CAAV;AACA,YAAIxF,EAAE+F,eAAN,EAAuB/F,EAAE+F,eAAF;;AAEvB,aAAKJ,SAAL,CAAe9K,MAAf,CAAsB,MAAtB;;AAEA,YAAIoH,WAAWxX,KAAKC,KAAL,CAAWsV,EAAEyF,YAAF,CAAeO,OAAf,CAAuB,OAAvB,CAAX,CAAf;AACA,YAAG/D,aAAa4C,MAAMI,KAAtB,EAA6B;AAC3B;AACD;AACDJ,cAAMoB,MAAN,CAAa,UAASpB,KAAT,EAAgB;AAC3BA,gBAAMK,IAAN,GAAajD,QAAb,EAAuB4C,MAAMI,KAA7B;AACD,SAFD;;AAIA,eAAO,KAAP;AACD,OAnBH,EAoBE,KApBF;AAuBD;AA1GK,GAAR;AA4GD,CA/GA;AAgHD;IAAOiB,O;AAEL,qBAAc;AAAA;;AACZ,SAAKtB,QAAL,GAAgB,GAAhB;AACA,SAAKuB,WAAL,GAAmB,0BAAnB;AACA,SAAKtB,KAAL,GAAa;AACXnI,WAAK,GADM;AAEXqF,oBAAc,GAFH;AAGXqE,gBAAU,GAHC;AAIX5D,iBAAW,GAJA;AAKXoB,gBAAU,GALC;AAMXU,iBAAW,GANA;AAOX+B,wBAAkB;AAPP,KAAb;AASD;;;;+BAEUjG,M,EAAQC,Q,EAAU;AAC3B;;AAEAD,aAAO+E,WAAP,GAAqB,YAAW;AAC9B,eAAO,CAAC/E,OAAO1D,GAAP,CAAW6F,MAAZ,IAAsBnC,OAAO1D,GAAP,CAAWpN,YAAX,IAA2B,aAAxD;AACD,OAFD;;AAIA8Q,aAAOgF,WAAP,GAAqB,YAAW;AAC9B,eAAO,CAAChF,OAAO1D,GAAP,CAAW2G,WAAZ,IAA2BjD,OAAO1D,GAAP,CAAWpN,YAAX,IAA2B,aAA7D;AACD,OAFD;;AAIA8Q,aAAOkG,MAAP,GAAgB,UAAStE,QAAT,EAAmBC,QAAnB,EAA6B;AAC3C7B,eAAO2B,YAAP,GAAsBC,QAAtB,EAAgCC,QAAhC;AACD,OAFD;;AAIA7B,aAAOmG,UAAP,GAAoB,UAASxc,KAAT,EAAgB,CAEnC,CAFD;;AAIAqW,aAAOoG,WAAP,GAAqB,UAASzc,KAAT,EAAgB,CAEpC,CAFD;;AAIAqW,aAAO6C,SAAP,GAAmB,UAASlZ,KAAT,EAAgB;AACjC,YAAImZ,cAAcnZ,MAAM0c,OAAN,IAAiB1c,MAAM2c,OAAzC;AACAtG,eAAOgG,QAAP,GAAkBhG,OAAO1D,GAAzB,EAA8BwG,WAA9B;AACD,OAHD;;AAKA9C,aAAOuG,QAAP,GAAkB,UAASC,MAAT,EAAiBrZ,MAAjB,EAAyB;AACzCqZ,eAAOb,eAAP;AACA,YAAIc,YAAY,EAACxJ,OAAO,IAAR,EAAc9P,QAAQA,MAAtB,EAA8B8D,SAAS,EAACgL,OAAO,EAAR,EAAvC,EAAhB;AACA9O,eAAO2D,QAAP,CAAgBiQ,OAAhB,CAAwB0F,SAAxB;AACD,OAJD;;AAMAzG,aAAO0G,UAAP,GAAoB,UAASpK,GAAT,EAAc;AAChC,YAAGA,IAAIrL,OAAJ,CAAYgL,KAAZ,IAAqBK,IAAIrL,OAAJ,CAAYgL,KAAZ,CAAkBlU,MAAlB,GAA2B,CAAnD,EAAsD;AACpDiY,iBAAOoC,SAAP,GAAmB9F,GAAnB;AACD;AACDA,YAAInP,MAAJ,CAAW2D,QAAX,CAAoB0Q,MAApB,CAA2BlF,IAAInP,MAAJ,CAAW2D,QAAX,CAAoBwI,OAApB,CAA4BgD,GAA5B,CAA3B,EAA6D,CAA7D;AACD,OALD;;AAOA0D,aAAO2G,SAAP,GAAmB,UAASrK,GAAT,EAAc;AAC/B0D,eAAOkE,SAAP,GAAmB5H,GAAnB;AACD,OAFD;;AAIA0D,aAAO4G,aAAP,GAAuB,UAAStK,GAAT,EAAc;AACnC,YAAG0D,OAAOiG,gBAAP,EAAH,EAA8B;AAC5BjG,iBAAOiG,gBAAP,GAA0B3J,GAA1B;AACD;AACF,OAJD;;AAMA0D,aAAO6G,aAAP,GAAuB,UAASvK,GAAT,EAAc;AACnC,YAAG,CAACA,IAAI4E,YAAL,IAAqB5E,IAAI4E,YAAJ,CAAiBnZ,MAAjB,IAA2B,CAAnD,EAAsD;AACpD;AACAiY,iBAAOkE,SAAP,GAAmB5H,GAAnB;AACA;AACD;AACD,YAAI8D,YAAY,GAAhB;AACA,YAAIpE,OAAO,CAACM,GAAD,CAAX;AACA,YAAIL,KAAJ;AACA,YAAGK,IAAInP,MAAJ,CAAWgV,MAAd,EAAsB;AACpBlG,kBAAQK,IAAI4E,YAAZ;AACD,SAFD,MAEO;AACLjF,kBAAQK,IAAInP,MAAJ,CAAW8D,OAAX,CAAmBgL,KAAnB,GAA2BmE,SAA3B,GAAuC9D,IAAI4E,YAAnD;AACD;;AAED5E,YAAIrL,OAAJ,CAAYgL,KAAZ,GAAoBA,KAApB;;AAEA,iBAAS6K,cAAT,CAAwBxK,GAAxB,EAA6B;AAAA;AAAA;AAAA;;AAAA;AAC3B,mCAAiBA,IAAIxL,QAArB,wIAA+B;AAAA,kBAAvBmR,KAAuB;;AAC7BA,oBAAMhR,OAAN,CAAcgL,KAAd,GAAsBgG,MAAM9U,MAAN,CAAa8D,OAAb,CAAqBgL,KAArB,GAA6BmE,SAA7B,GAAyC6B,MAAMf,YAArE;AACAlF,mBAAKlP,IAAL,CAAUmV,KAAV;AACA6E,6BAAe7E,KAAf;AACD;AAL0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAM5B;;AAED6E,uBAAexK,GAAf;;AAEAA,YAAI6G,OAAJ,GAAc,KAAd;;AAEAnD,eAAOwD,QAAP,GAAkBxH,IAAlB;AACD,OA9BD;;AAgCAgE,aAAO+G,gBAAP,GAA0B,UAASzK,GAAT,EAAc;AACtC,YAAI0K,aAAa,CAAjB;AACA,YAAI7Z,SAASmP,IAAInP,MAAjB;AACA,eAAMA,MAAN,EAAc;AACZ6Z;AACA7Z,mBAASA,OAAOA,MAAhB;AACD;;AAED,eAAO6Z,UAAP;AACD,OATD;;AAWAhH,aAAOiH,iBAAP,GAA2B,UAAS3K,GAAT,EAAc;AACvC,YAAGA,IAAIpN,YAAJ,IAAoB,aAAvB,EAAsC;AACpC,iBAAO,SAAP;AACD;;AAED;AACA,YAAG,CAACoN,IAAI7Q,IAAR,EAAc;AACZ,iBAAO,SAAP;AACD;;AAGD,YAAIyb,MAAMlH,OAAO+G,gBAAP,CAAwBzK,GAAxB,CAAV;AACA,YAAI6K,cAAc;AAChB,aAAG,MADa;AAEhB,aAAG,MAFa;AAGhB,aAAG,SAHa;AAIhB,aAAG,QAJa;AAKhB,aAAG;AALa,UAMhBD,GANgB,CAAlB;;AAQA,YAAG,CAACC,WAAJ,EAAiB;AACfA,wBAAc,SAAd;AACD;;AAED;AACA,YAAG7K,IAAIgH,UAAJ,IAAkBhH,IAAIgH,UAAJ,CAAeC,SAApC,EAA+C;AAC7C4D,yBAAe,QAAf;AACD;;AAED,eAAOA,WAAP;AACD,OA9BD;AAgCD;;;;;;AAGHrB,QAAQzB,WAAR,GAAsB,IAAtB;;AAEAxE,QAAQ9K,MAAR,CAAe,KAAf,EAAsBwP,SAAtB,CAAgC,SAAhC,EAA2C;AAAA,SAAM,IAAIuB,OAAJ,EAAN;AAAA,CAA3C","file":"app.js","sourcesContent":["\"use strict\";\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ComponentManager =\n/*#__PURE__*/\nfunction () {\n  function ComponentManager(permissions, onReady) {\n    _classCallCheck(this, ComponentManager);\n\n    this.sentMessages = [];\n    this.messageQueue = [];\n    this.loggingEnabled = false;\n    this.acceptsThemes = true;\n    this.activeThemes = [];\n    this.initialPermissions = permissions;\n    this.onReadyCallback = onReady;\n    this.coallesedSaving = true;\n    this.coallesedSavingDelay = 250;\n    this.registerMessageHandler();\n  }\n\n  _createClass(ComponentManager, [{\n    key: \"registerMessageHandler\",\n    value: function registerMessageHandler() {\n      var _this = this;\n\n      var messageHandler = function messageHandler(event) {\n        if (_this.loggingEnabled) {\n          console.log(\"Components API Message received:\", event.data);\n        } // We don't have access to window.parent.origin due to cross-domain restrictions.\n        // Check referrer if available, otherwise defer to checking for first-run value.\n        // Craft URL objects so that example.com === example.com/\n\n\n        if (document.referrer) {\n          var referrer = new URL(document.referrer).origin;\n          var eventOrigin = new URL(event.origin).origin;\n\n          if (referrer !== eventOrigin) {\n            return;\n          }\n        } // The first message will be the most reliable one, so we won't change it after any subsequent events,\n        // in case you receive an event from another window.\n\n\n        if (!_this.origin) {\n          _this.origin = event.origin;\n        } else if (event.origin !== _this.origin) {\n          // If event origin doesn't match first-run value, return.\n          return;\n        } // Mobile environment sends data as JSON string\n\n\n        var data = event.data;\n        var parsedData = typeof data === \"string\" ? JSON.parse(data) : data;\n\n        _this.handleMessage(parsedData);\n      };\n      /*\n        Mobile (React Native) uses `document`, web/desktop uses `window`.addEventListener\n        for postMessage API to work properly.\n         Update May 2019:\n        As part of transitioning React Native webview into the community package,\n        we'll now only need to use window.addEventListener.\n         However, we want to maintain backward compatibility for Mobile < v3.0.5, so we'll keep document.addEventListener\n         Also, even with the new version of react-native-webview, Android may still require document.addEventListener (while iOS still only requires window.addEventListener)\n        https://github.com/react-native-community/react-native-webview/issues/323#issuecomment-467767933\n       */\n\n\n      document.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n      window.addEventListener(\"message\", function (event) {\n        messageHandler(event);\n      }, false);\n    }\n  }, {\n    key: \"handleMessage\",\n    value: function handleMessage(payload) {\n      if (payload.action === \"component-registered\") {\n        this.sessionKey = payload.sessionKey;\n        this.componentData = payload.componentData;\n        this.onReady(payload.data);\n\n        if (this.loggingEnabled) {\n          console.log(\"Component successfully registered with payload:\", payload);\n        }\n      } else if (payload.action === \"themes\") {\n        if (this.acceptsThemes) {\n          this.activateThemes(payload.data.themes);\n        }\n      } else if (payload.original) {\n        // get callback from queue\n        var originalMessage = this.sentMessages.filter(function (message) {\n          return message.messageId === payload.original.messageId;\n        })[0];\n\n        if (!originalMessage) {\n          // Connection must have been reset. Alert the user.\n          alert(\"This extension is attempting to communicate with Standard Notes, but an error is preventing it from doing so. Please restart this extension and try again.\");\n        }\n\n        if (originalMessage.callback) {\n          originalMessage.callback(payload.data);\n        }\n      }\n    }\n  }, {\n    key: \"onReady\",\n    value: function onReady(data) {\n      this.environment = data.environment;\n      this.platform = data.platform;\n      this.uuid = data.uuid;\n      this.isMobile = this.environment == \"mobile\";\n\n      if (this.initialPermissions && this.initialPermissions.length > 0) {\n        this.requestPermissions(this.initialPermissions);\n      }\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.messageQueue[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var message = _step.value;\n          this.postMessage(message.action, message.data, message.callback);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator[\"return\"] != null) {\n            _iterator[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.messageQueue = [];\n\n      if (this.loggingEnabled) {\n        console.log(\"onReadyData\", data);\n      }\n\n      this.activateThemes(data.activeThemeUrls || []);\n\n      if (this.onReadyCallback) {\n        this.onReadyCallback();\n      }\n    }\n  }, {\n    key: \"getSelfComponentUUID\",\n    value: function getSelfComponentUUID() {\n      return this.uuid;\n    }\n  }, {\n    key: \"isRunningInDesktopApplication\",\n    value: function isRunningInDesktopApplication() {\n      return this.environment === \"desktop\";\n    }\n  }, {\n    key: \"setComponentDataValueForKey\",\n    value: function setComponentDataValueForKey(key, value) {\n      this.componentData[key] = value;\n      this.postMessage(\"set-component-data\", {\n        componentData: this.componentData\n      }, function (data) {});\n    }\n  }, {\n    key: \"clearComponentData\",\n    value: function clearComponentData() {\n      this.componentData = {};\n      this.postMessage(\"set-component-data\", {\n        componentData: this.componentData\n      }, function (data) {});\n    }\n  }, {\n    key: \"componentDataValueForKey\",\n    value: function componentDataValueForKey(key) {\n      return this.componentData[key];\n    }\n  }, {\n    key: \"postMessage\",\n    value: function postMessage(action, data, callback) {\n      if (!this.sessionKey) {\n        this.messageQueue.push({\n          action: action,\n          data: data,\n          callback: callback\n        });\n        return;\n      }\n\n      var message = {\n        action: action,\n        data: data,\n        messageId: this.generateUUID(),\n        sessionKey: this.sessionKey,\n        api: \"component\"\n      };\n      var sentMessage = JSON.parse(JSON.stringify(message));\n      sentMessage.callback = callback;\n      this.sentMessages.push(sentMessage); // Mobile (React Native) requires a string for the postMessage API.\n\n      if (this.isMobile) {\n        message = JSON.stringify(message);\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Posting message:\", message);\n      }\n\n      window.parent.postMessage(message, this.origin);\n    }\n  }, {\n    key: \"setSize\",\n    value: function setSize(type, width, height) {\n      this.postMessage(\"set-size\", {\n        type: type,\n        width: width,\n        height: height\n      }, function (data) {});\n    }\n  }, {\n    key: \"requestPermissions\",\n    value: function requestPermissions(permissions, callback) {\n      this.postMessage(\"request-permissions\", {\n        permissions: permissions\n      }, function (data) {\n        callback && callback();\n      }.bind(this));\n    }\n  }, {\n    key: \"streamItems\",\n    value: function streamItems(contentTypes, callback) {\n      if (!Array.isArray(contentTypes)) {\n        contentTypes = [contentTypes];\n      }\n\n      this.postMessage(\"stream-items\", {\n        content_types: contentTypes\n      }, function (data) {\n        callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"streamContextItem\",\n    value: function streamContextItem(callback) {\n      var _this2 = this;\n\n      this.postMessage(\"stream-context-item\", null, function (data) {\n        var item = data.item;\n        /*\n          If this is a new context item than the context item the component was currently entertaining,\n          we want to immediately commit any pending saves, because if you send the new context item to the\n          component before it has commited its presave, it will end up first replacing the UI with new context item,\n          and when the debouncer executes to read the component UI, it will be reading the new UI for the previous item.\n        */\n\n        var isNewItem = !_this2.lastStreamedItem || _this2.lastStreamedItem.uuid !== item.uuid;\n\n        if (isNewItem && _this2.pendingSaveTimeout) {\n          clearTimeout(_this2.pendingSaveTimeout);\n\n          _this2._performSavingOfItems(_this2.pendingSaveParams);\n\n          _this2.pendingSaveTimeout = null;\n          _this2.pendingSaveParams = null;\n        }\n\n        _this2.lastStreamedItem = item;\n        callback(_this2.lastStreamedItem);\n      });\n    }\n  }, {\n    key: \"selectItem\",\n    value: function selectItem(item) {\n      this.postMessage(\"select-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"createItem\",\n    value: function createItem(item, callback) {\n      this.postMessage(\"create-item\", {\n        item: this.jsonObjectForItem(item)\n      }, function (data) {\n        var item = data.item; // A previous version of the SN app had an issue where the item in the reply to create-item\n        // would be nested inside \"items\" and not \"item\". So handle both cases here.\n\n        if (!item && data.items && data.items.length > 0) {\n          item = data.items[0];\n        }\n\n        this.associateItem(item);\n        callback && callback(item);\n      }.bind(this));\n    }\n  }, {\n    key: \"createItems\",\n    value: function createItems(items, callback) {\n      var _this3 = this;\n\n      var mapped = items.map(function (item) {\n        return _this3.jsonObjectForItem(item);\n      });\n      this.postMessage(\"create-items\", {\n        items: mapped\n      }, function (data) {\n        callback && callback(data.items);\n      }.bind(this));\n    }\n  }, {\n    key: \"associateItem\",\n    value: function associateItem(item) {\n      this.postMessage(\"associate-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"deassociateItem\",\n    value: function deassociateItem(item) {\n      this.postMessage(\"deassociate-item\", {\n        item: this.jsonObjectForItem(item)\n      });\n    }\n  }, {\n    key: \"clearSelection\",\n    value: function clearSelection() {\n      this.postMessage(\"clear-selection\", {\n        content_type: \"Tag\"\n      });\n    }\n  }, {\n    key: \"deleteItem\",\n    value: function deleteItem(item, callback) {\n      this.deleteItems([item], callback);\n    }\n  }, {\n    key: \"deleteItems\",\n    value: function deleteItems(items, callback) {\n      var params = {\n        items: items.map(function (item) {\n          return this.jsonObjectForItem(item);\n        }.bind(this))\n      };\n      this.postMessage(\"delete-items\", params, function (data) {\n        callback && callback(data);\n      });\n    }\n  }, {\n    key: \"sendCustomEvent\",\n    value: function sendCustomEvent(action, data, callback) {\n      this.postMessage(action, data, function (data) {\n        callback && callback(data);\n      }.bind(this));\n    }\n  }, {\n    key: \"saveItem\",\n    value: function saveItem(item, callback) {\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      this.saveItems([item], callback, skipDebouncer);\n    }\n    /* Presave allows clients to perform any actions last second before the save actually occurs (like setting previews).\n       Saves debounce by default, so if a client needs to compute a property on an item before saving, it's best to\n       hook into the debounce cycle so that clients don't have to implement their own debouncing.\n     */\n\n  }, {\n    key: \"saveItemWithPresave\",\n    value: function saveItemWithPresave(item, presave, callback) {\n      this.saveItemsWithPresave([item], presave, callback);\n    }\n  }, {\n    key: \"saveItemsWithPresave\",\n    value: function saveItemsWithPresave(items, presave, callback) {\n      this.saveItems(items, callback, false, presave);\n    }\n  }, {\n    key: \"_performSavingOfItems\",\n    value: function _performSavingOfItems(_ref) {\n      var items = _ref.items,\n          presave = _ref.presave,\n          callback = _ref.callback;\n      // presave block allows client to gain the benefit of performing something in the debounce cycle.\n      presave && presave();\n      var mappedItems = [];\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = items[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var item = _step2.value;\n          mappedItems.push(this.jsonObjectForItem(item));\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2[\"return\"] != null) {\n            _iterator2[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.postMessage(\"save-items\", {\n        items: mappedItems\n      }, function (data) {\n        callback && callback();\n      });\n    }\n    /*\n    skipDebouncer allows saves to go through right away rather than waiting for timeout.\n    This should be used when saving items via other means besides keystrokes.\n    */\n\n  }, {\n    key: \"saveItems\",\n    value: function saveItems(items, callback) {\n      var _this4 = this;\n\n      var skipDebouncer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var presave = arguments.length > 3 ? arguments[3] : undefined;\n\n      // We need to make sure that when we clear a pending save timeout,\n      // we carry over those pending items into the new save.\n      if (!this.pendingSaveItems) {\n        this.pendingSaveItems = [];\n      }\n\n      if (this.coallesedSaving == true && !skipDebouncer) {\n        if (this.pendingSaveTimeout) {\n          clearTimeout(this.pendingSaveTimeout);\n        }\n\n        var incomingIds = items.map(function (item) {\n          return item.uuid;\n        }); // Replace any existing save items with incoming values\n        // Only keep items here who are not in incomingIds\n\n        var preexistingItems = this.pendingSaveItems.filter(function (item) {\n          return !incomingIds.includes(item.uuid);\n        }); // Add new items, now that we've made sure it's cleared of incoming items.\n\n        this.pendingSaveItems = preexistingItems.concat(items); // We'll potentially need to commit early if stream-context-item message comes in\n\n        this.pendingSaveParams = {\n          items: this.pendingSaveItems,\n          presave: presave,\n          callback: callback\n        };\n        this.pendingSaveTimeout = setTimeout(function () {\n          _this4._performSavingOfItems(_this4.pendingSaveParams);\n\n          _this4.pendingSaveItems = [];\n          _this4.pendingSaveTimeout = null;\n          _this4.pendingSaveParams = null;\n        }, this.coallesedSavingDelay);\n      } else {\n        this._performSavingOfItems({\n          items: items,\n          presave: presave,\n          callback: callback\n        });\n      }\n    }\n  }, {\n    key: \"jsonObjectForItem\",\n    value: function jsonObjectForItem(item) {\n      var copy = Object.assign({}, item);\n      copy.children = null;\n      copy.parent = null;\n      return copy;\n    }\n  }, {\n    key: \"getItemAppDataValue\",\n    value: function getItemAppDataValue(item, key) {\n      var AppDomain = \"org.standardnotes.sn\";\n      var data = item.content.appData && item.content.appData[AppDomain];\n\n      if (data) {\n        return data[key];\n      } else {\n        return null;\n      }\n    }\n    /* Themes */\n\n  }, {\n    key: \"activateThemes\",\n    value: function activateThemes(incomingUrls) {\n      if (this.loggingEnabled) {\n        console.log(\"Incoming themes\", incomingUrls);\n      }\n\n      if (this.activeThemes.sort().toString() == incomingUrls.sort().toString()) {\n        // incoming are same as active, do nothing\n        return;\n      }\n\n      var themesToActivate = incomingUrls || [];\n      var themesToDeactivate = [];\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.activeThemes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var activeUrl = _step3.value;\n\n          if (!incomingUrls.includes(activeUrl)) {\n            // active not present in incoming, deactivate it\n            themesToDeactivate.push(activeUrl);\n          } else {\n            // already present in active themes, remove it from themesToActivate\n            themesToActivate = themesToActivate.filter(function (candidate) {\n              return candidate != activeUrl;\n            });\n          }\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3[\"return\"] != null) {\n            _iterator3[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      if (this.loggingEnabled) {\n        console.log(\"Deactivating themes:\", themesToDeactivate);\n        console.log(\"Activating themes:\", themesToActivate);\n      }\n\n      for (var _i = 0, _themesToDeactivate = themesToDeactivate; _i < _themesToDeactivate.length; _i++) {\n        var theme = _themesToDeactivate[_i];\n        this.deactivateTheme(theme);\n      }\n\n      this.activeThemes = incomingUrls;\n      var _iteratorNormalCompletion4 = true;\n      var _didIteratorError4 = false;\n      var _iteratorError4 = undefined;\n\n      try {\n        for (var _iterator4 = themesToActivate[Symbol.iterator](), _step4; !(_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done); _iteratorNormalCompletion4 = true) {\n          var url = _step4.value;\n\n          if (!url) {\n            continue;\n          }\n\n          var link = document.createElement(\"link\");\n          link.id = btoa(url);\n          link.href = url;\n          link.type = \"text/css\";\n          link.rel = \"stylesheet\";\n          link.media = \"screen,print\";\n          link.className = \"custom-theme\";\n          document.getElementsByTagName(\"head\")[0].appendChild(link);\n        }\n      } catch (err) {\n        _didIteratorError4 = true;\n        _iteratorError4 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion4 && _iterator4[\"return\"] != null) {\n            _iterator4[\"return\"]();\n          }\n        } finally {\n          if (_didIteratorError4) {\n            throw _iteratorError4;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"themeElementForUrl\",\n    value: function themeElementForUrl(url) {\n      var elements = Array.from(document.getElementsByClassName(\"custom-theme\")).slice();\n      return elements.find(function (element) {\n        // We used to search here by `href`, but on desktop, with local file:// urls, that didn't work for some reason.\n        return element.id == btoa(url);\n      });\n    }\n  }, {\n    key: \"deactivateTheme\",\n    value: function deactivateTheme(url) {\n      var element = this.themeElementForUrl(url);\n\n      if (element) {\n        element.disabled = true;\n        element.parentNode.removeChild(element);\n      }\n    }\n    /* Theme caching is currently disabled. Might be enabled in the future if neccessary. */\n\n    /*\n    activateCachedThemes() {\n      let themes = this.getCachedThemeUrls();\n      let writeToCache = false;\n      if(this.loggingEnabled) { console.log(\"Activating cached themes\", themes); }\n      this.activateThemes(themes, writeToCache);\n    }\n     cacheThemeUrls(urls) {\n      if(this.loggingEnabled) { console.log(\"Caching theme urls\", urls); }\n      localStorage.setItem(\"cachedThemeUrls\", JSON.stringify(urls));\n    }\n     decacheThemeUrls() {\n      localStorage.removeItem(\"cachedThemeUrls\");\n    }\n     getCachedThemeUrls() {\n      let urls = localStorage.getItem(\"cachedThemeUrls\");\n      if(urls) {\n        return JSON.parse(urls);\n      } else {\n        return [];\n      }\n    }\n    */\n\n    /* Utilities */\n\n  }, {\n    key: \"generateUUID\",\n    value: function generateUUID() {\n      var crypto = window.crypto || window.msCrypto;\n\n      if (crypto) {\n        var buf = new Uint32Array(4);\n        crypto.getRandomValues(buf);\n        var idx = -1;\n        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          idx++;\n          var r = buf[idx >> 3] >> idx % 8 * 4 & 15;\n          var v = c == 'x' ? r : r & 0x3 | 0x8;\n          return v.toString(16);\n        });\n      } else {\n        var d = new Date().getTime();\n\n        if (window.performance && typeof window.performance.now === \"function\") {\n          d += performance.now(); //use high-precision timer if available\n        }\n\n        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n          var r = (d + Math.random() * 16) % 16 | 0;\n          d = Math.floor(d / 16);\n          return (c == 'x' ? r : r & 0x3 | 0x8).toString(16);\n        });\n        return uuid;\n      }\n    }\n  }]);\n\n  return ComponentManager;\n}();\n\nif (typeof module != \"undefined\" && typeof module.exports != \"undefined\") {\n  module.exports = ComponentManager;\n}\n\nif (window) {\n  window.ComponentManager = ComponentManager;\n}\n//# sourceMappingURL=dist.js.map\n;\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SNTheme = exports.SNSmartTag = exports.SNServerExtension = exports.SNMfa = exports.SNEncryptedStorage = exports.SNTag = exports.SNNote = exports.SNExtension = exports.Action = exports.SNEditor = exports.SNComponent = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _standardFileJs = require(\"standard-file-js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SNComponent = exports.SNComponent = function (_SFItem) {\n  _inherits(SNComponent, _SFItem);\n\n  function SNComponent(json_obj) {\n    _classCallCheck(this, SNComponent);\n\n    // If making a copy of an existing component (usually during sign in if you have a component active in the session),\n    // which may have window set, you may get a cross-origin exception since you'll be trying to copy the window. So we clear it here.\n    json_obj.window = null;\n\n    var _this = _possibleConstructorReturn(this, (SNComponent.__proto__ || Object.getPrototypeOf(SNComponent)).call(this, json_obj));\n\n    if (!_this.componentData) {\n      _this.componentData = {};\n    }\n\n    if (!_this.disassociatedItemIds) {\n      _this.disassociatedItemIds = [];\n    }\n\n    if (!_this.associatedItemIds) {\n      _this.associatedItemIds = [];\n    }\n    return _this;\n  }\n\n  _createClass(SNComponent, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      /* Legacy */\n      // We don't want to set the url directly, as we'd like to phase it out.\n      // If the content.url exists, we'll transfer it to legacy_url\n      // We'll only need to set this if content.hosted_url is blank, otherwise, hosted_url is the url replacement.\n      if (!content.hosted_url) {\n        this.legacy_url = content.url;\n      }\n\n      /* New */\n      this.local_url = content.local_url;\n      this.hosted_url = content.hosted_url || content.url;\n      this.offlineOnly = content.offlineOnly;\n\n      if (content.valid_until) {\n        this.valid_until = new Date(content.valid_until);\n      }\n\n      this.name = content.name;\n      this.autoupdateDisabled = content.autoupdateDisabled;\n\n      this.package_info = content.package_info;\n\n      // the location in the view this component is located in. Valid values are currently tags-list, note-tags, and editor-stack`\n      this.area = content.area;\n\n      this.permissions = content.permissions;\n      if (!this.permissions) {\n        this.permissions = [];\n      }\n\n      this.active = content.active;\n\n      // custom data that a component can store in itself\n      this.componentData = content.componentData || {};\n\n      // items that have requested a component to be disabled in its context\n      this.disassociatedItemIds = content.disassociatedItemIds || [];\n\n      // items that have requested a component to be enabled in its context\n      this.associatedItemIds = content.associatedItemIds || [];\n    }\n  }, {\n    key: \"handleDeletedContent\",\n    value: function handleDeletedContent() {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"handleDeletedContent\", this).call(this);\n\n      this.active = false;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        legacy_url: this.legacy_url,\n        hosted_url: this.hosted_url,\n        local_url: this.local_url,\n        valid_until: this.valid_until,\n        offlineOnly: this.offlineOnly,\n        name: this.name,\n        area: this.area,\n        package_info: this.package_info,\n        permissions: this.permissions,\n        active: this.active,\n        autoupdateDisabled: this.autoupdateDisabled,\n        componentData: this.componentData,\n        disassociatedItemIds: this.disassociatedItemIds,\n        associatedItemIds: this.associatedItemIds\n      };\n\n      var superParams = _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"isEditor\",\n    value: function isEditor() {\n      return this.area == \"editor-editor\";\n    }\n  }, {\n    key: \"isTheme\",\n    value: function isTheme() {\n      return this.content_type == \"SN|Theme\" || this.area == \"themes\";\n    }\n  }, {\n    key: \"isDefaultEditor\",\n    value: function isDefaultEditor() {\n      return this.getAppDataItem(\"defaultEditor\") == true;\n    }\n  }, {\n    key: \"setLastSize\",\n    value: function setLastSize(size) {\n      this.setAppDataItem(\"lastSize\", size);\n    }\n  }, {\n    key: \"getLastSize\",\n    value: function getLastSize() {\n      return this.getAppDataItem(\"lastSize\");\n    }\n  }, {\n    key: \"acceptsThemes\",\n    value: function acceptsThemes() {\n      if (this.content.package_info && \"acceptsThemes\" in this.content.package_info) {\n        return this.content.package_info.acceptsThemes;\n      }\n      return true;\n    }\n\n    /*\n      The key used to look up data that this component may have saved to an item.\n      This key will be look up on the item, and not on itself.\n     */\n\n  }, {\n    key: \"getClientDataKey\",\n    value: function getClientDataKey() {\n      if (this.legacy_url) {\n        return this.legacy_url;\n      } else {\n        return this.uuid;\n      }\n    }\n  }, {\n    key: \"hasValidHostedUrl\",\n    value: function hasValidHostedUrl() {\n      return this.hosted_url || this.legacy_url;\n    }\n  }, {\n    key: \"keysToIgnoreWhenCheckingContentEquality\",\n    value: function keysToIgnoreWhenCheckingContentEquality() {\n      return [\"active\", \"disassociatedItemIds\", \"associatedItemIds\"].concat(_get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"keysToIgnoreWhenCheckingContentEquality\", this).call(this));\n    }\n\n    /*\n      An associative component depends on being explicitly activated for a given item, compared to a dissaciative component,\n      which is enabled by default in areas unrelated to a certain item.\n     */\n\n  }, {\n    key: \"isAssociative\",\n    value: function isAssociative() {\n      return Component.associativeAreas().includes(this.area);\n    }\n  }, {\n    key: \"associateWithItem\",\n    value: function associateWithItem(item) {\n      this.associatedItemIds.push(item.uuid);\n    }\n  }, {\n    key: \"isExplicitlyEnabledForItem\",\n    value: function isExplicitlyEnabledForItem(item) {\n      return this.associatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"isExplicitlyDisabledForItem\",\n    value: function isExplicitlyDisabledForItem(item) {\n      return this.disassociatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Component\";\n    }\n  }], [{\n    key: \"associativeAreas\",\n    value: function associativeAreas() {\n      return [\"editor-editor\"];\n    }\n  }]);\n\n  return SNComponent;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEditor = exports.SNEditor = function (_SFItem2) {\n  _inherits(SNEditor, _SFItem2);\n\n  function SNEditor(json_obj) {\n    _classCallCheck(this, SNEditor);\n\n    var _this2 = _possibleConstructorReturn(this, (SNEditor.__proto__ || Object.getPrototypeOf(SNEditor)).call(this, json_obj));\n\n    if (!_this2.notes) {\n      _this2.notes = [];\n    }\n    if (!_this2.data) {\n      _this2.data = {};\n    }\n    return _this2;\n  }\n\n  _createClass(SNEditor, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n      this.name = content.name;\n      this.data = content.data || {};\n      this.default = content.default;\n      this.systemEditor = content.systemEditor;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        url: this.url,\n        name: this.name,\n        data: this.data,\n        default: this.default,\n        systemEditor: this.systemEditor\n      };\n\n      var superParams = _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"referenceParams\",\n    value: function referenceParams() {\n      var references = _.map(this.notes, function (note) {\n        return { uuid: note.uuid, content_type: note.content_type };\n      });\n\n      return references;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, item)) {\n          this.notes.push(item);\n        }\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.pull(this.notes, item);\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeAndDirtyAllRelationships\",\n    value: function removeAndDirtyAllRelationships() {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeAndDirtyAllRelationships\", this).call(this);\n      this.notes = [];\n    }\n  }, {\n    key: \"removeReferencesNotPresentIn\",\n    value: function removeReferencesNotPresentIn(references) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeReferencesNotPresentIn\", this).call(this, references);\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(this.notes, { uuid: note.uuid });\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"potentialItemOfInterestHasChangedItsUUID\",\n    value: function potentialItemOfInterestHasChangedItsUUID(newItem, oldUUID, newUUID) {\n      if (newItem.content_type === \"Note\" && _.find(this.notes, { uuid: oldUUID })) {\n        _.remove(this.notes, { uuid: oldUUID });\n        this.notes.push(newItem);\n      }\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(key, value) {\n      var dataHasChanged = JSON.stringify(this.data[key]) !== JSON.stringify(value);\n      if (dataHasChanged) {\n        this.data[key] = value;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"dataForKey\",\n    value: function dataForKey(key) {\n      return this.data[key] || {};\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Editor\";\n    }\n  }]);\n\n  return SNEditor;\n}(_standardFileJs.SFItem);\n\n;\nvar Action = exports.Action = function Action(json) {\n  _classCallCheck(this, Action);\n\n  _.merge(this, json);\n  this.running = false; // in case running=true was synced with server since model is uploaded nondiscriminatory\n  this.error = false;\n  if (this.lastExecuted) {\n    // is string\n    this.lastExecuted = new Date(this.lastExecuted);\n  }\n};\n\nvar SNExtension = exports.SNExtension = function (_SFItem3) {\n  _inherits(SNExtension, _SFItem3);\n\n  function SNExtension(json) {\n    _classCallCheck(this, SNExtension);\n\n    var _this3 = _possibleConstructorReturn(this, (SNExtension.__proto__ || Object.getPrototypeOf(SNExtension)).call(this, json));\n\n    if (json.actions) {\n      _this3.actions = json.actions.map(function (action) {\n        return new Action(action);\n      });\n    }\n\n    if (!_this3.actions) {\n      _this3.actions = [];\n    }\n    return _this3;\n  }\n\n  _createClass(SNExtension, [{\n    key: \"actionsWithContextForItem\",\n    value: function actionsWithContextForItem(item) {\n      return this.actions.filter(function (action) {\n        return action.context == item.content_type || action.context == \"Item\";\n      });\n    }\n  }, {\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.description = content.description;\n      this.url = content.url;\n      this.name = content.name;\n      this.package_info = content.package_info;\n      this.supported_types = content.supported_types;\n      if (content.actions) {\n        this.actions = content.actions.map(function (action) {\n          return new Action(action);\n        });\n      }\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        name: this.name,\n        url: this.url,\n        package_info: this.package_info,\n        description: this.description,\n        actions: this.actions.map(function (a) {\n          return _.omit(a, [\"subrows\", \"subactions\"]);\n        }),\n        supported_types: this.supported_types\n      };\n\n      var superParams = _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Extension\";\n    }\n  }]);\n\n  return SNExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNNote = exports.SNNote = function (_SFItem4) {\n  _inherits(SNNote, _SFItem4);\n\n  function SNNote(json_obj) {\n    _classCallCheck(this, SNNote);\n\n    var _this4 = _possibleConstructorReturn(this, (SNNote.__proto__ || Object.getPrototypeOf(SNNote)).call(this, json_obj));\n\n    if (!_this4.text) {\n      // Some external editors can't handle a null value for text.\n      // Notes created on mobile with no text have a null value for it,\n      // so we'll just set a default here.\n      _this4.text = \"\";\n    }\n\n    if (!_this4.tags) {\n      _this4.tags = [];\n    }\n    return _this4;\n  }\n\n  _createClass(SNNote, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n      this.text = content.text;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title,\n        text: this.text\n      };\n\n      var superParams = _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      /*\n      Legacy.\n      Previously, note/tag relationships were bidirectional, however in some cases there\n      may be broken links such that a note has references to a tag and not vice versa.\n      Now, only tags contain references to notes. For old notes that may have references to tags,\n      we want to transfer them over to the tag.\n       */\n      if (item.content_type == \"Tag\") {\n        item.addItemAsRelationship(this);\n      }\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"setIsBeingReferencedBy\",\n    value: function setIsBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"setIsNoLongerBeingReferencedBy\",\n    value: function setIsNoLongerBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsNoLongerBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      this.tags.forEach(function (tag) {\n        _.remove(tag.notes, { uuid: this.uuid });\n      }.bind(this));\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"informReferencesOfUUIDChange\", this).call(this);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.tags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var tag = _step.value;\n\n          _.remove(tag.notes, { uuid: oldUUID });\n          tag.notes.push(this);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"tagDidFinishSyncing\",\n    value: function tagDidFinishSyncing(tag) {\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"safeText\",\n    value: function safeText() {\n      return this.text || \"\";\n    }\n  }, {\n    key: \"safeTitle\",\n    value: function safeTitle() {\n      return this.title || \"\";\n    }\n  }, {\n    key: \"clearSavedTagsString\",\n    value: function clearSavedTagsString() {\n      this.savedTagsString = null;\n    }\n  }, {\n    key: \"tagsString\",\n    value: function tagsString() {\n      this.savedTagsString = SNTag.arrayToDisplayString(this.tags);\n      return this.savedTagsString;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Note\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Note\";\n    }\n  }], [{\n    key: \"filterDummyNotes\",\n    value: function filterDummyNotes(notes) {\n      var filtered = notes.filter(function (note) {\n        return note.dummy == false || note.dummy == null;\n      });\n      return filtered;\n    }\n  }]);\n\n  return SNNote;\n}(_standardFileJs.SFItem);\n\n;\nvar SNTag = exports.SNTag = function (_SFItem5) {\n  _inherits(SNTag, _SFItem5);\n\n  function SNTag(json_obj) {\n    _classCallCheck(this, SNTag);\n\n    var _this5 = _possibleConstructorReturn(this, (SNTag.__proto__ || Object.getPrototypeOf(SNTag)).call(this, json_obj));\n\n    if (!_this5.content_type) {\n      _this5.content_type = \"Tag\";\n    }\n\n    if (!_this5.notes) {\n      _this5.notes = [];\n    }\n    return _this5;\n  }\n\n  _createClass(SNTag, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title\n      };\n\n      var superParams = _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, { uuid: item.uuid })) {\n          this.notes.push(item);\n          item.tags.push(this);\n        }\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.remove(this.notes, { uuid: item.uuid });\n        _.remove(item.tags, { uuid: this.uuid });\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"updateLocalRelationships\",\n    value: function updateLocalRelationships() {\n      var references = this.content.references;\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.slice().forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(note.tags, { uuid: this.uuid });\n          _.remove(this.notes, { uuid: note.uuid });\n\n          note.setIsNoLongerBeingReferencedBy(this);\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      var _this6 = this;\n\n      this.notes.forEach(function (note) {\n        _.remove(note.tags, { uuid: _this6.uuid });\n        note.setIsNoLongerBeingReferencedBy(_this6);\n      });\n\n      this.notes.length = 0;\n\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.notes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var note = _step2.value;\n\n          _.remove(note.tags, { uuid: oldUUID });\n          note.tags.push(this);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"didFinishSyncing\",\n    value: function didFinishSyncing() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.notes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var note = _step3.value;\n\n          note.tagDidFinishSyncing(this);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"isSmartTag\",\n    value: function isSmartTag() {\n      return this.content_type == \"SN|SmartTag\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Tag\";\n    }\n  }], [{\n    key: \"arrayToDisplayString\",\n    value: function arrayToDisplayString(tags) {\n      return tags.sort(function (a, b) {\n        return a.title > b.title;\n      }).map(function (tag, i) {\n        return \"#\" + tag.title;\n      }).join(\" \");\n    }\n  }]);\n\n  return SNTag;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEncryptedStorage = exports.SNEncryptedStorage = function (_SFItem6) {\n  _inherits(SNEncryptedStorage, _SFItem6);\n\n  function SNEncryptedStorage() {\n    _classCallCheck(this, SNEncryptedStorage);\n\n    return _possibleConstructorReturn(this, (SNEncryptedStorage.__proto__ || Object.getPrototypeOf(SNEncryptedStorage)).apply(this, arguments));\n  }\n\n  _createClass(SNEncryptedStorage, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEncryptedStorage.prototype.__proto__ || Object.getPrototypeOf(SNEncryptedStorage.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.storage = content.storage;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|EncryptedStorage\";\n    }\n  }]);\n\n  return SNEncryptedStorage;\n}(_standardFileJs.SFItem);\n\n;\nvar SNMfa = exports.SNMfa = function (_SFItem7) {\n  _inherits(SNMfa, _SFItem7);\n\n  function SNMfa(json_obj) {\n    _classCallCheck(this, SNMfa);\n\n    return _possibleConstructorReturn(this, (SNMfa.__proto__ || Object.getPrototypeOf(SNMfa)).call(this, json_obj));\n  }\n\n  // mapContentToLocalProperties(content) {\n  //   super.mapContentToLocalProperties(content)\n  //   this.serverContent = content;\n  // }\n  //\n  // structureParams() {\n  //   return _.merge(this.serverContent, super.structureParams());\n  // }\n\n  _createClass(SNMfa, [{\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|MFA\";\n    }\n  }]);\n\n  return SNMfa;\n}(_standardFileJs.SFItem);\n\n;\nvar SNServerExtension = exports.SNServerExtension = function (_SFItem8) {\n  _inherits(SNServerExtension, _SFItem8);\n\n  function SNServerExtension() {\n    _classCallCheck(this, SNServerExtension);\n\n    return _possibleConstructorReturn(this, (SNServerExtension.__proto__ || Object.getPrototypeOf(SNServerExtension)).apply(this, arguments));\n  }\n\n  _createClass(SNServerExtension, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNServerExtension.prototype.__proto__ || Object.getPrototypeOf(SNServerExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n    }\n  }, {\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|Extension\";\n    }\n  }]);\n\n  return SNServerExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNSmartTag = exports.SNSmartTag = function (_SNTag) {\n  _inherits(SNSmartTag, _SNTag);\n\n  function SNSmartTag(json_ob) {\n    _classCallCheck(this, SNSmartTag);\n\n    var _this10 = _possibleConstructorReturn(this, (SNSmartTag.__proto__ || Object.getPrototypeOf(SNSmartTag)).call(this, json_ob));\n\n    _this10.content_type = \"SN|SmartTag\";\n    return _this10;\n  }\n\n  _createClass(SNSmartTag, null, [{\n    key: \"systemSmartTags\",\n    value: function systemSmartTags() {\n      return [new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdAllNotes,\n        content: {\n          title: \"All notes\",\n          isSystemTag: true,\n          isAllTag: true,\n          predicate: new SFPredicate.fromArray([\"content_type\", \"=\", \"Note\"])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdArchivedNotes,\n        content: {\n          title: \"Archived\",\n          isSystemTag: true,\n          isArchiveTag: true,\n          predicate: new SFPredicate.fromArray([\"archived\", \"=\", true])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdTrashedNotes,\n        content: {\n          title: \"Trash\",\n          isSystemTag: true,\n          isTrashTag: true,\n          predicate: new SFPredicate.fromArray([\"content.trashed\", \"=\", true])\n        }\n      })];\n    }\n  }]);\n\n  return SNSmartTag;\n}(SNTag);\n\nSNSmartTag.SystemSmartTagIdAllNotes = \"all-notes\";\nSNSmartTag.SystemSmartTagIdArchivedNotes = \"archived-notes\";\nSNSmartTag.SystemSmartTagIdTrashedNotes = \"trashed-notes\";\n;\nvar SNTheme = exports.SNTheme = function (_SNComponent) {\n  _inherits(SNTheme, _SNComponent);\n\n  function SNTheme(json_obj) {\n    _classCallCheck(this, SNTheme);\n\n    var _this11 = _possibleConstructorReturn(this, (SNTheme.__proto__ || Object.getPrototypeOf(SNTheme)).call(this, json_obj));\n\n    _this11.area = \"themes\";\n    return _this11;\n  }\n\n  _createClass(SNTheme, [{\n    key: \"isLayerable\",\n    value: function isLayerable() {\n      return this.package_info && this.package_info.layerable;\n    }\n  }, {\n    key: \"setMobileRules\",\n    value: function setMobileRules(rules) {\n      this.setAppDataItem(\"mobileRules\", rules);\n    }\n  }, {\n    key: \"getMobileRules\",\n    value: function getMobileRules() {\n      return this.getAppDataItem(\"mobileRules\") || { constants: {}, rules: {} };\n    }\n\n    // Same as getMobileRules but without default value\n\n  }, {\n    key: \"hasMobileRules\",\n    value: function hasMobileRules() {\n      return this.getAppDataItem(\"mobileRules\");\n    }\n  }, {\n    key: \"setNotAvailOnMobile\",\n    value: function setNotAvailOnMobile(na) {\n      this.setAppDataItem(\"notAvailableOnMobile\", na);\n    }\n  }, {\n    key: \"getNotAvailOnMobile\",\n    value: function getNotAvailOnMobile() {\n      return this.getAppDataItem(\"notAvailableOnMobile\");\n    }\n\n    /* We must not use .active because if you set that to true, it will also activate that theme on desktop/web */\n\n  }, {\n    key: \"setMobileActive\",\n    value: function setMobileActive(active) {\n      this.setAppDataItem(\"mobileActive\", active);\n    }\n  }, {\n    key: \"isMobileActive\",\n    value: function isMobileActive() {\n      return this.getAppDataItem(\"mobileActive\");\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Theme\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Theme\";\n    }\n  }]);\n\n  return SNTheme;\n}(SNComponent);\n\n;\n\nif (typeof window !== 'undefined' && window !== null) {\n  // window is for some reason defined in React Native, but throws an exception when you try to set to it\n  try {\n    window.SNNote = SNNote;\n    window.SNTag = SNTag;\n    window.SNSmartTag = SNSmartTag;\n    window.SNMfa = SNMfa;\n    window.SNServerExtension = SNServerExtension;\n    window.SNComponent = SNComponent;\n    window.SNEditor = SNEditor;\n    window.SNExtension = SNExtension;\n    window.SNTheme = SNTheme;\n    window.SNEncryptedStorage = SNEncryptedStorage;\n  } catch (e) {\n    console.log(\"Exception while exporting sn-models window variables\", e);\n  }\n}\n//# sourceMappingURL=transpiled.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentManager = new window.ComponentManager([], () => {\n      // on ready\n      $rootScope.platform = componentManager.platform;\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => {\n          const aTitle = a.content.title.toLowerCase(), bTitle = b.content.title.toLowerCase();\n          return (aTitle > bTitle) - (aTitle < bTitle);\n        });\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentManager.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        /*\n        Create smart tag. Examples:\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentManager.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentManager.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentManager.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentManager.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentManager.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master && !tag.content.isSystemTag) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentManager.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentManager.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentManager.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : SNSmartTag.systemSmartTags();\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentManager.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"neutral\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}